<!-- HTML header for doxygen 1.9.2-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Infrastructure: Run with MDK-Professional</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="printComponentTabs.js"></script>
<script type="text/javascript" src="footer.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="$extra_stylesheet" rel="stylesheet" type="text/css" />
<link href="extra_stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 55px;">
  <td id="projectlogo" style="padding: 1em;"><img alt="Logo" src="arm.png"/></td>
  <td style="padding-left: 2em; padding-bottom: 1em;padding-top: 1em;">
   <div id="projectname">Virtual Hardware
   &#160;<span id="projectnumber">Version 0.3 - beta</span>
   </div>
   <div id="projectbrief">Infrastructure Service and Tool Integration</div>
  </td>
  <!--END !PROJECT_NAME-->
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<div id="Compnav" class="tabs1">
    <ul class="tablist">
      <script type="text/javascript">
		<!--
		writeComponentTabs.call(this);
		//-->
      </script>
	  </ul>
</div>
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('run_mdk_pro.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Run with MDK-Professional </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >This section explains how Arm Virtual Hardware (AVH) processors can be used with <a href="https://developer.arm.com/tools-and-software/embedded/keil-mdk">Keil MDK</a> tools for developing and debugging embedded applications on a local computer.</p>
<h1><a class="anchor" id="mdk_vht_install"></a>
Tools Installation</h1>
<ul>
<li><a href="https://www.keil.com/demo/eval/arm.htm">Download Keil MDK</a> v5.37 or above and install it on your Windows PC, if not present yet.</li>
<li>Ensure that <a href="https://developer.arm.com/tools-and-software/embedded/keil-mdk/buy">MDK-Professional Edition</a> is activated in MDK as this is required for running AVH models. If MDK-Professional license is not available, you can <a href="https://developer.arm.com/documentation/101454/latest/License-Management/MDK-Professional-Evaluation">request an evaluation license</a>.</li>
<li>[<em>Optional</em>] Enable Telnet Client on Windows 10. This will allow to observe UART output from the AVH device during debug.<ul>
<li>Open <em>Start</em> &gt; <em>Settings</em>.</li>
<li>In the search box, type <em>Turn Windows features on or off</em> and click on the suggested item. The <em>Windows Features</em> dialog opens.</li>
<li>Select the <em>Telnet Client</em> check box and click <em>OK</em>. The installation might take several minutes to complete.</li>
</ul>
<img src="windows_telnet_enable.png" alt="" class="inline" title="Enable Windows Telnet Client"/></li>
</ul>
<h1><a class="anchor" id="mdk_project_config"></a>
Project Configuration</h1>
<p >Two important configuration areas need special attention in MDK projects for Arm Virtual Hardware CPUs:</p><ul>
<li><a class="el" href="run_mdk_pro.html#mdk_vht_targets">Target selection</a> in the project. This is required for new projects or when changing the target device in an existing project.</li>
<li><a class="el" href="run_mdk_pro.html#mdk_vht_debug">Run and debug configuration</a> in the project. This step is typically needed for setting up any project, but with reference examples brief verification of the default settings can be sufficient.</li>
</ul>
<p >Table below lists the Cortex-M cores supported with Arm Virtual Hardware, corresponding device names, the CMSIS Pack with device support, as well as simulation models provided with MDK.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Arm Cortex-M core   </th><th class="markdownTableHeadLeft">AVH Device name   </th><th class="markdownTableHeadLeft">CMSIS Pack with device definition   </th><th class="markdownTableHeadLeft">Virtual Hardware model in MDK<sup> 1</sup>   </th><th class="markdownTableHeadLeft">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Cortex-M0   </td><td class="markdownTableBodyLeft">CMSDK_CM0_VHT   </td><td class="markdownTableBodyLeft">Keil.V2M-MPS2_CMx_BSP from v1.8.0   </td><td class="markdownTableBodyLeft">VHT_MPS2_Cortex-M0_MDK.exe   </td><td class="markdownTableBodyLeft">CPU with Cortex-M0 core    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">Cortex-M0+   </td><td class="markdownTableBodyLeft">CMSDK_CM0plus_VHT   </td><td class="markdownTableBodyLeft">Keil.V2M-MPS2_CMx_BSP from v1.8.0   </td><td class="markdownTableBodyLeft">VHT_MPS2_Cortex-M0plus_MDK.exe   </td><td class="markdownTableBodyLeft">CPU with Cortex-M0+ core    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Cortex-M3   </td><td class="markdownTableBodyLeft">CMSDK_CM3_VHT   </td><td class="markdownTableBodyLeft">Keil.V2M-MPS2_CMx_BSP from v1.8.0   </td><td class="markdownTableBodyLeft">VHT_MPS2_Cortex-M3_MDK.exe   </td><td class="markdownTableBodyLeft">CPU with Cortex-M3 core    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">Cortex-M4   </td><td class="markdownTableBodyLeft">CMSDK_CM4_VHT   </td><td class="markdownTableBodyLeft">Keil.V2M-MPS2_CMx_BSP from v1.8.0   </td><td class="markdownTableBodyLeft">VHT_MPS2_Cortex-M4_MDK.exe   </td><td class="markdownTableBodyLeft">CPU with Cortex-M4 core    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Cortex-M4, FP   </td><td class="markdownTableBodyLeft">CMSDK_CM4_FP_VHT   </td><td class="markdownTableBodyLeft">Keil.V2M-MPS2_CMx_BSP from v1.8.0   </td><td class="markdownTableBodyLeft">VHT_MPS2_Cortex-M4_MDK.exe   </td><td class="markdownTableBodyLeft">CPU with Cortex-M4 core and Floating Point Unit (FPU) support    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">Cortex-M7   </td><td class="markdownTableBodyLeft">CMSDK_CM7_VHT   </td><td class="markdownTableBodyLeft">Keil.V2M-MPS2_CMx_BSP from v1.8.0   </td><td class="markdownTableBodyLeft">VHT_MPS2_Cortex-M7_MDK.exe   </td><td class="markdownTableBodyLeft">CPU with Cortex-M7 core    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Cortex-M7, FP(SP)   </td><td class="markdownTableBodyLeft">CMSDK_CM7_SP_VHT   </td><td class="markdownTableBodyLeft">Keil.V2M-MPS2_CMx_BSP from v1.8.0   </td><td class="markdownTableBodyLeft">VHT_MPS2_Cortex-M7_MDK.exe   </td><td class="markdownTableBodyLeft">CPU with Cortex-M7 core and Single Precision FPU support    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">Cortex-M7, FP(DP)   </td><td class="markdownTableBodyLeft">CMSDK_CM7_DP_VHT   </td><td class="markdownTableBodyLeft">Keil.V2M-MPS2_CMx_BSP from v1.8.0   </td><td class="markdownTableBodyLeft">VHT_MPS2_Cortex-M7_MDK.exe   </td><td class="markdownTableBodyLeft">CPU with Cortex-M7 core and Double Precision FPU support    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Cortex-M23   </td><td class="markdownTableBodyLeft">IOTKit_CM23_VHT   </td><td class="markdownTableBodyLeft">Keil.V2M-MPS2_IOTKit_BSP from v1.5.0   </td><td class="markdownTableBodyLeft">VHT_MPS2_Cortex-M23_MDK.exe   </td><td class="markdownTableBodyLeft">CPU with Cortex-M23 core    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">Cortex-M33   </td><td class="markdownTableBodyLeft">IOTKit_CM33_VHT   </td><td class="markdownTableBodyLeft">Keil.V2M-MPS2_IOTKit_BSP from v1.5.0   </td><td class="markdownTableBodyLeft">VHT_MPS2_Cortex-M33_MDK.exe   </td><td class="markdownTableBodyLeft">CPU with Cortex-M33 core    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Cortex-M33, FP   </td><td class="markdownTableBodyLeft">IOTKit_CM33_FP_VHT   </td><td class="markdownTableBodyLeft">Keil.V2M-MPS2_IOTKit_BSP from v1.5.0   </td><td class="markdownTableBodyLeft">VHT_MPS2_Cortex-M33_MDK.exe   </td><td class="markdownTableBodyLeft">CPU with Cortex-M33 core and Floating Point Unit (FPU) support    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">Cortex-M55   </td><td class="markdownTableBodyLeft">SSE-300-MPS3   </td><td class="markdownTableBodyLeft">ARM.V2M_MPS3_SSE_300_BSP from v1.2.0   </td><td class="markdownTableBodyLeft">VHT_MPS3_Corstone_SSE-300.exe<br  />
VHT_Corstone_SSE-300_Ethos-U55.exe<br  />
VHT_Corstone_SSE-300_Ethos-U65.exe   </td><td class="markdownTableBodyLeft">Corstone-300 SoC with Cortex-M55.<br  />
Same device definition is used, but a model shall be selected<br  />
depending on the required microNPU (none, Ethos-U55 or Ethos-U65)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Cortex-M85   </td><td class="markdownTableBodyLeft">SSE-310-MPS3   </td><td class="markdownTableBodyLeft">not available yet   </td><td class="markdownTableBodyLeft">VHT_Corstone_SSE-310.exe   </td><td class="markdownTableBodyLeft">CPU with Cortex-M85 core   </td></tr>
</table>
<blockquote class="doxtable">
<p ><sup>1</sup> The Virtual Hardware Targets can be found in the <code>/ARM/VHT/</code> folder in the MDK installation directory as used for <a class="el" href="run_mdk_pro.html#mdk_vht_install">Tools Installation</a>, for example,<code>C:/Keil_v5/ARM/VHT/</code>. </p>
</blockquote>
<h2><a class="anchor" id="mdk_vht_targets"></a>
Target selection</h2>
<p >AVH device support is implemented with the same CMSIS principles as used for real hardware targets and explained in <a href="https://arm-software.github.io/CMSIS_5/Pack/html/index.html">CMSIS Pack</a> and <a href="https://arm-software.github.io/CMSIS_5/Core/html/index.html">CMSIS-Core(M)</a>.</p>
<p >When opening an existing MDK project or importing it from a .cprj file you will be asked if any missing packs required by the project shall be installed. If you agree to that, also the necessary pack with device definition for the target device used in the project will be automatically installed.</p>
<p >When creating a new project or when changing the target in an existing project you need to select an AVH target as follows:</p><ul>
<li>Install the CMSIS pack with target device definition, if not present yet:<ul>
<li>Start <a href="https://developer.arm.com/documentation/101407/latest/Creating-Applications/Software-Components/Pack-Installer"><em>Pack Installer</em></a> utility.</li>
<li>In <em>Devices</em> tab expand <em>ARM</em> section and select the target Cortex-M core.</li>
<li>In the <a href="https://developer.arm.com/documentation/101407/latest/Creating-Applications/Software-Components/Pack-Installer/Packs-Dialog"><em>Packs</em> tab</a> under <em>Device Specific</em> category select the target CMSIS pack that implements the required AVH device according to the table in <a class="el" href="run_mdk_pro.html#mdk_project_config">Project Configuration</a>.</li>
<li>Press <em>Install</em> or <em>Update</em> button in the Action field to get the latest version installed. For example for Arm Cortex-M4:<br  />
 <img src="mdk_vht_device_pack.png" alt="" class="inline" title="Select AVH device as a target"/></li>
<li>Observe the button status changed to <em>Up to date</em> and return to the project in µVision.</li>
</ul>
</li>
<li>Select AVH device as the target in your project:<ul>
<li>In the project open <em>Options for target...</em> dialog and select <em>Device</em> tab.</li>
<li>In the list of device vendors expand <em>ARM</em> group.</li>
<li>Expand the group of your target Cortex-M core.</li>
<li>In the list select the target device according to the table in <a class="el" href="run_mdk_pro.html#mdk_project_config">Project Configuration</a> and press <em>OK</em>.<br  />
 For example for Arm Cortex-M4:<br  />
 <img src="mdk_vht_device_select.png" alt="" class="inline" title="Select AVH device as a target"/></li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="mdk_vht_debug"></a>
Run and debug configuration</h2>
<p >Perform the following steps to configure execution and debug of an MDK project on an AVH device:</p>
<ul>
<li>Open <em>Options for Target...</em> dialog and navigate to the <em>Debug</em> tab.</li>
<li>In <em>Use:</em> drop-down menu select the <em>Models Debugger</em>. <br  />
The exact name varies slightly depending on the target device core: <em>Models Cortex-M Debugger</em> for Cortex-M0/M0+/M3/M4/M7 devices and <em>Models ARMv8-M Debugger</em> for Cortex-M23/M33/M55/M85. <br  />
For example for Corstone-300 with a Cortex-M55 core:<br  />
 <img src="uv4_model_debug.png" alt="" class="inline" title="Models ARMv8-M Debugger"/></li>
<li>Click on the <em>Settings</em> button. This opens corresponding <em>Models Target Driver Setup_ dialog</em>. <br  />
Following fields are important to fill:<ul>
<li><em>Command</em>: shall contain the path to the AVH model executable file that corresponds to the selected AVH device. See table in <a class="el" href="run_mdk_pro.html#mdk_project_config">Project Configuration</a>.</li>
<li><em>Arguments</em>: can be used to specify additional <a href="https://developer.arm.com/documentation/100966/1116/Getting-Started-with-Fixed-Virtual-Platforms/FVP-command-line-options">FVP command-line options</a> to be used with the model execution.</li>
<li><em>Target</em>: specifies the CPU to be used for execution. Click the <em>Browse</em> button (...) and select the target CPU available on the target.</li>
<li><em>Configuration File</em>: points to the file with model configuration parameters (passed to the model executable with <code>-f</code> option).</li>
</ul>
A correct configuration for Corestone-300 can be as follows:<br  />
 <img src="vht_uv4_setup_basic.png" alt="" class="inline" title="AVH model configuration in AVH GetStarted example"/></li>
</ul>
<p ><a href="https://developer.arm.com/documentation/101452/latest/Debug-Driver-Configuration">Fast Models Debug Driver Configuration</a> explains the configuration dialog in details.</p>
<h1><a class="anchor" id="mdk_cprj_export"></a>
Project Export</h1>
<p >Universal <a href="https://arm-software.github.io/CMSIS_5/Build/html/cprjFormat_pg.html">.cprj format</a> is required for building the program with Arm Virtual Hardware cloud environment. So it is important to keep the MDK project files and the <em>cprj</em> file synchronized. For that after saving modifications in the MDK project go to the µVision menu <a href="https://developer.arm.com/documentation/101407/latest/User-Interface/Project-Menu-and-Commands/Export-Menu"><em>Project</em> - <em>Export</em></a> and select <em>Save project to CPRJ format</em>.</p>
<h1><a class="anchor" id="mdk_program_run"></a>
Program Build and Debug</h1>
<p >Project build and debug on an AVH device can be done in the similar way as any other Keil MDK project:</p>
<ul>
<li>Press <em>Rebuild</em> button in µVision toolbar (or use <code>F7</code> hotkey).</li>
<li>Start the debug session from µVision toolbar (or with <code>Ctrl-F5</code>). The model executable window should pop up (with <code>C:\WINDOWS\system32\cmd.exe</code>) but it will stay empty during the session.</li>
<li>If enabled in <a class="el" href="run_mdk_pro.html#mdk_vht_debug">Run and debug configuration</a>, a Telnet client will start. Program output should be expected there.</li>
<li>Debug the project as usual with available µVision functionality. Refer to <a href="https://developer.arm.com/documentation/101407">µVision User's Guide</a> for details about user interface and debug capabilities. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
	Copyright &copy; 2021-2022 Arm Limited (or its affiliates). All rights reserved.
	<!-- Use script below for auto-inserting date, project name, version, etc  -->
	<!-- <script type="text/javascript">
        writeFooter.call(this);
    </script> -->
    </li>
  </ul>
</div>
</body>
</html>
