<!-- HTML header for doxygen 1.9.2-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Infrastructure: Run AMI with Jenkins</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="printComponentTabs.js"></script>
<script type="text/javascript" src="footer.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="$extra_stylesheet" rel="stylesheet" type="text/css" />
<link href="extra_stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 55px;">
  <td id="projectlogo" style="padding: 1em;"><img alt="Logo" src="arm.png"/></td>
  <td style="padding-left: 2em; padding-bottom: 1em;padding-top: 1em;">
   <div id="projectname">Virtual Hardware
   &#160;<span id="projectnumber">Version 0.2 - beta</span>
   </div>
   <div id="projectbrief">Infrastructure Service and Tool Integration</div>
  </td>
  <!--END !PROJECT_NAME-->
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<div id="Compnav" class="tabs1">
    <ul class="tablist">
      <script type="text/javascript">
		<!--
		writeComponentTabs.call(this);
		//-->
      </script>
	  </ul>
</div>
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('run_ami_jenkins.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Run AMI with Jenkins </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a class="anchor" id="md_src_jenkins"></a> Use of Arm Virtual Hardware (AVH) AMI can be integrated into <a href="https://www.jenkins.io/">Jenkins pipelines</a> for automating software builds and tests.</p>
<p >Two approaches can be followed to create and control instances of the AVH AMIs with Jenkins:</p><ul>
<li><a class="el" href="run_ami_jenkins.html#avh_jenkins_node">Using AVH AMI as a Jenkins node</a> : a classic approach with a Jenkins node created in AWS.</li>
<li><a class="el" href="run_ami_jenkins.html#avh_module_jenkins">Using AVH Client</a> : a simplified way with Jenkins as a thin wrapper on top of avhclient python module.</li>
</ul>
<p >Example implementations of both approaches are provided in <a href="https://github.com/ARM-software/AVH-GetStarted/">GetStarted example</a> and explained in this chapter.</p>
<dl class="section note"><dt>Note</dt><dd>Refer to <a class="el" href="index.html#mainpage">Infrastructure</a> for others ways to use the Arm Virtual Hardware.</dd></dl>
<h1><a class="anchor" id="avh_jenkins_node"></a>
Using AVH AMI as a Jenkins node</h1>
<p >This is a common way to implement Jenkins pipelines on AWS.</p>
<p >A Jenkins Controller uses Amazon EC2 plugin to create an EC2 instance as a Jenkins node from an AVH AMI. Then the Jenkins node gets connected by SSH to the Jenkins Controller and the Jenkins commands are executed directly on the EC2 instance.</p>
<h2><a class="anchor" id="autotoc_md12"></a>
Implementation example</h2>
<p >The example implementation is available in <a href="https://github.com/ARM-software/AVH-GetStarted/tree/main/.jenkins/AVH-as-Jenkins-Node/">.jenkins/AVH-as-Jenkins-Node/</a> and consists of the following items:</p>
<ul>
<li><code>configuration-as-code/</code> provides an example of Amazon EC2 plugin code.</li>
<li><code>jobDSL/</code> contains Jenkins configuration as code to create the AVH Jenkins Job.</li>
<li><code>pipeline/</code> implements an example pipeline for running AVH AMI as Jenkins Node.</li>
</ul>
<h2><a class="anchor" id="autotoc_md13"></a>
Dependencies</h2>
<h3><a class="anchor" id="autotoc_md14"></a>
AWS Account</h3>
<p >Following resources are required on the AWS side:</p>
<ul>
<li><a class="el" href="index.html#Subscribe">Subscription</a> to Arm Virtual Hardware AMI.</li>
<li>IAM User with Access Keys for the AWS Account. IAM setup can be found at <a href="https://plugins.jenkins.io/ec2/#plugin-content-iam-setup">plugins.jenkins.io/ec2/#plugin-content-iam-setup</a>.</li>
<li>EC2 Security Group with Ingress SSH port allowed.</li>
<li>SSH Keys to communicate with the EC2 instance as Jenkins Node.</li>
<li>Subnet Id needs to be informed with EC2 instance.</li>
</ul>
<p >An AWS Cloudformation template file can be used to create most of the required AWS Resources for AVH AMI, please refer to <a href="https://github.com/ARM-software/AVH-GetStarted/tree/main/infrastructure/cloudformation">./infrastructure/cloudformation/</a> folder in the GetStarted example.</p>
<h3><a class="anchor" id="autotoc_md15"></a>
Jenkins plugins</h3>
<p >Following Jenkins plugins are used by the example implementation:</p>
<ul>
<li><a href="https://plugins.jenkins.io/ec2/">Amazon EC2</a> - Tested on v1.57</li>
<li><a href="https://plugins.jenkins.io/job-dsl/">JobDSL - needed if the JobDSL code is used</a> - Tested on v1.77</li>
</ul>
<h3><a class="anchor" id="autotoc_md16"></a>
Jenkins credentials</h3>
<p >Following Jenkins credentials need to be configured:</p><ul>
<li>AWS Credential for IAM User (<code>AWS_ACCESS_KEY_ID</code> and <code>AWS_SECRET_ACCESS_KEY</code>)</li>
<li>AWS SSH Private Key to be associated with the EC2 instance.</li>
</ul>
<h1><a class="anchor" id="avh_module_jenkins"></a>
Using AVH Client</h1>
<p >In this approach, a python module <a href="https://github.com/ARM-software/avhclient"><em>avhclient</em></a> drives the communication with the AVH AMI. The Jenkins pipeline is just a light-weight front end that uses the VHT Python module, and the actual work is done by an EC2 instance created and controlled with the commands from the VHT Python module built on top of AWS SDK.</p>
<p >This approach is simpler to implement but the capabilities are limited by the functionality of the VHT Python module.</p>
<h2><a class="anchor" id="autotoc_md17"></a>
Implementation example</h2>
<p >The example implementation using VHT Python module is available in <a href="https://github.com/ARM-software/AVH-GetStarted/tree/main/.jenkins/Using-AVH-Module">.jenkins/Using-AVH-Module/</a> and consists of the following items:</p>
<ul>
<li><code>jobDSL/</code> contains Jenkins configuration as code to create the AVH Jenkins Job.</li>
<li><code>pipeline/</code> implements an example pipeline for running AVH AMI using VHT Python Module.</li>
</ul>
<h2><a class="anchor" id="autotoc_md18"></a>
Dependencies</h2>
<h3><a class="anchor" id="autotoc_md19"></a>
AWS Account</h3>
<p >Following resources are required on the AWS side:</p>
<ul>
<li><a class="el" href="index.html#Subscribe">Subscription</a> to Arm Virtual Hardware AMI.</li>
<li>IAM User with Access Keys for the AWS Account.</li>
<li>IAM Instance Profile to be associated with the VHT EC2 instances.</li>
<li>S3 Bucket to store temporary files.</li>
<li>EC2 Security Group with Ingress SSH port allowed.</li>
<li>[<em>Optional</em>] SSH Key if you would like to debug on EC2.</li>
<li>Subnet Id needs to be informed with EC2 instance.</li>
</ul>
<p >An AWS CloudFormation template file can be used to create the required AWS resources for AVH AMI. Refer to <a href="https://github.com/ARM-software/AVH-GetStarted/tree/main/infrastructure/cloudformation">./infrastructure/cloudformation/</a> folder in the GetStarted example.</p>
<h3><a class="anchor" id="autotoc_md20"></a>
Jenkins plugins</h3>
<p >Following Jenkins plugins are used by the example implementation:</p>
<ul>
<li><a href="https://plugins.jenkins.io/aws-credentials/">CloudBees AWS Credentials</a> - Tested on v1.29</li>
<li><a href="https://plugins.jenkins.io/pyenv-pipeline/">Pyenv-pipeline</a> - Tested on v2.1.2</li>
<li><a href="https://plugins.jenkins.io/job-dsl/">JobDSL - needed if the JobDSL code is used</a> - Tested on v1.77</li>
</ul>
<h3><a class="anchor" id="autotoc_md21"></a>
Jenkins credentials</h3>
<p >Following Jenkins credentials need to be configured:</p><ul>
<li>AWS Credential for IAM User (<code>AWS_ACCESS_KEY_ID</code> and <code>AWS_SECRET_ACCESS_KEY</code>)</li>
<li>[<em>Optional</em>] AWS SSH Private Key to be associated with the EC2 instance. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
	Copyright &copy; 2021-2022 Arm Limited (or its affiliates). All rights reserved.
	<!-- Use script below for auto-inserting date, project name, version, etc  -->
	<!-- <script type="text/javascript">
        writeFooter.call(this);
    </script> -->
    </li>
  </ul>
</div>
</body>
</html>
