<!-- HTML header for doxygen 1.9.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Infrastructure: Run AMI with GitHub Actions</title>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="extra_navtree.css" rel="stylesheet" type="text/css"/>
<link href="extra_stylesheet.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="printComponentTabs.js"></script>
<script type="text/javascript" src="footer.js"></script>
<script type="text/javascript" src="toc.js"></script>
<script type="text/javascript">
  DoxygenAwesomeInteractiveToc.init()
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<script type="text/javascript" src="darkmode_toggle.js"></script>
<link href="extra_stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="extra_navtree.css" rel="stylesheet" type="text/css"/>
<link href="extra_search.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow" style="height: 55px;">
  <td id="projectlogo" style="padding: 1em;"><img alt="Logo" src="arm.png"/></td>
  <td style="padding-left: 2em; padding-bottom: 1em;padding-top: 1em;">
   <div id="projectname">Arm Virtual Hardware
   &#160;<span id="projectnumber">Version 2.0.0</span>
   </div>
   <div id="projectbrief">Infrastructure Services and Tool Integrations</div>
  </td>
  <!--END !PROJECT_NAME-->
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<div id="Compnav" class="tabs1">
    <ul class="tablist">
      <script type="text/javascript">
		<!--
		writeComponentTabs.call(this);
		//-->
      </script>
	  </ul>
</div>
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('run_ami_github.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Run AMI with GitHub Actions </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_src_avh_ami_github"></a> GitHub Actions help you to automate tasks within your software development life cycle. They are event-driven, meaning that you can run a series of commands after a specified event has occurred. For example, every time someone commits a push or creates a pull request for a repository branch, you can automatically trigger a job that executes automated build and run scripts on Arm Virtual Hardware. Refer to <a href="https://docs.github.com/en/actions/learn-github-actions/introduction-to-github-actions">Introduction to GitHub Actions</a> for information about the components of GitHub Actions.</p>
<p>GitHub Actions workflow executes your commands on a Virtual Machine (GitHub Runner) that is hosted either directly by GitHub or can be self-hosted. The descriptions below refer to using GitHub-hosted Runner as a simpler way to get started with GitHub Actions.</p>
<p>Integration of Arm Virtual Hardware into GitHub Actions is enabled with <a class="el" href="avhclient.html">AVH Client</a> - a python module that manages remote connection, upload, build, and execution of programs on AVH AMI instances. The figure below shows a concept for a simple GitHub Action workflow that builds and tests a program on Arm Virtual Hardware.</p>
<div class="image">
<img src="GitHub-GH-AWS.png" alt=""/>
<div class="caption">
GitHub Action workflow for AVH AMI integration</div></div>
    <p>The workflow has three main steps:</p>
<ul>
<li><b>Step 1: Initial setup</b> - prepares the GitHub Runner environment.<ul>
<li>This includes copying of the necessary project files; installing of required utilities such as AVH Client; provisioning of AWS parameters. etc. Explained in <a class="el" href="run_ami_github.html#github_add_workflow">Add GitHub Actions workflow</a>.</li>
</ul>
</li>
<li><b>Step 2: Execute AVH Actions</b> - calls the <em>avhclient</em> to execute AVH Actions on AVH AMI.<ul>
<li>Described in <a class="el" href="run_ami_github.html#github_avh_actions">Define AVH Actions</a>.</li>
</ul>
</li>
<li><b>Step 3: Publish results</b> - processes execution results.<ul>
<li>This could include archiving the execution artifacts (build image, log files, etc.), publishing test results and others. Referenced in <a class="el" href="run_ami_github.html#github_add_workflow">Add GitHub Actions workflow</a>.</li>
</ul>
</li>
</ul>
<p>Sections below explain implementation of corresponding GitHub Action in details:</p><ul>
<li><a class="el" href="run_ami_github.html#github_aws_setup">**Setup AWS infrastructure**</a> to ensure that all resources required for running AVH Client are available.</li>
<li><a class="el" href="run_ami_github.html#github_add_workflow">**Add GitHub Action workflow**</a> to your GitHub repository that implements the jobs to run on a GitHub Runner.</li>
<li><a class="el" href="run_ami_github.html#github_add_secrets">**Add GitHub Secrets**</a> to your GitHub repository.</li>
<li><a class="el" href="run_ami_github.html#github_avh_actions">**Define AVH Actions**</a> to be executed on the AVH AMI.</li>
</ul>
<p><b>Examples</b></p>
<p>GitHub Actions workflow is implemented in most <a href="../../examples/html/index.html"><b>AVH reference examples</b></a>. If you are not well familiar with GitHub Actions, it is recommended to start with <a href="../../examples/html/GetStarted.html">AVH-GetStarted example</a> that explains the CI implementation in details.</p>
<h1><a class="anchor" id="github_aws_setup"></a>
AWS Setup</h1>
<p>The requirements to the AWS infrastructure are determined by the use of AVH Client with AWS backend. See <a class="el" href="avhclient.html#avhclient_setup_aws">AWS backend setup</a> in AVH Client description. <a class="el" href="avhclient.html#avhclient_setup_cloudformation">CloudFormation template</a> provides a simple way to get the necessary resources setup in AWS.</p>
<p>The AWS parameters obtained in this step can be then <a class="el" href="run_ami_github.html#github_add_secrets">stored as GitHub Secrets</a> and provided to the GitHub Runner environment in GitHub Actions workflow.</p>
<h1><a class="anchor" id="github_add_workflow"></a>
Add GitHub Actions workflow</h1>
<p>GitHub Actions workflows get implemented in <code>.github/workflows/&lt;workflowFileName&gt;.yml</code> files in the GitHub project repository. See GitHub tutorial <a href="https://docs.github.com/en/actions/using-workflows">Using workflows</a> for full details.</p>
<p>The workflow for running a job on AVH AMI would typically be constructed as follows:</p>
<ol type="1">
<li><b>Specify the events that should trigger the workflow execution.</b> <br  />
 For example to trigger it with each push on the main branch, as well as to enable manual start from the repository page, this would be defined as: <div class="fragment"><div class="line">on:</div>
<div class="line">  push:</div>
<div class="line">    branches: [ main ]</div>
<div class="line">  workflow_dispatch:</div>
</div><!-- fragment --> <br  />
</li>
<li><b>Set environment variables required by the workflow.</b> <br  />
 GitHub Secrets provide a secure way to do this for sensitive information. See <a class="el" href="run_ami_github.html#github_add_secrets">Add GitHub Secrets</a> for details. For example, if a new AMI instance shall be created for each workflow run, the mandatory AWS parameters could be assigned in the workflow yml file as follows: <div class="fragment"><div class="line">env:</div>
<div class="line">  AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}</div>
<div class="line">  AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}</div>
<div class="line">  AWS_DEFAULT_REGION: ${{ secrets.AWS_DEFAULT_REGION }}</div>
<div class="line">  AWS_S3_BUCKET_NAME: ${{ secrets.AWS_S3_BUCKET_NAME }} </div>
<div class="line">  AWS_IAM_PROFILE: ${{ secrets.AWS_IAM_PROFILE }}</div>
<div class="line">  AWS_SECURITY_GROUP_ID: ${{ secrets.AWS_SECURITY_GROUP_ID }}</div>
<div class="line">  AWS_SUBNET_ID: ${{ secrets.AWS_SUBNET_ID }}</div>
</div><!-- fragment --> <br  />
</li>
<li><b>Define a job for running AVH Client</b>, including the preparation steps. Key steps are:<ul>
<li>Check out repository with the target application. Standard GitHub Action is available for this.</li>
<li>Install python. Standard GitHub Action is available for this.</li>
<li>Install avhclient module. As explained in <a class="el" href="avhclient.html#avhclient_install">Installation</a>.</li>
<li>Run AVH Client <code>execute</code> command with AWS backend. A .yml specfile shall be provided to the command, specifying the actions to be executed on AVH AMI. See <a class="el" href="run_ami_github.html#github_avh_actions">Define AVH Actions</a>.</li>
</ul>
Implementation for such job could be as follows: <div class="fragment"><div class="line">jobs:</div>
<div class="line">  avh_run:</div>
<div class="line">    runs-on: ubuntu-latest</div>
<div class="line">    steps:</div>
<div class="line">    - name: Check out repository code</div>
<div class="line">      uses: actions/checkout@v3</div>
<div class="line"> </div>
<div class="line">    - name: Set up Python 3.10</div>
<div class="line">      uses: actions/setup-python@v2</div>
<div class="line">      with:</div>
<div class="line">        python-version: &#39;3.10&#39;</div>
<div class="line"> </div>
<div class="line">    - name: Install AVH Client for Python</div>
<div class="line">      run: |</div>
<div class="line">        pip install git+https://github.com/ARM-software/avhclient.git@v0.1.5</div>
<div class="line"> </div>
<div class="line">    - name: Run tests</div>
<div class="line">      id: avh</div>
<div class="line">      run: |</div>
<div class="line">        avhclient -b aws execute --specfile avh.yml</div>
</div><!-- fragment --> <br  />
</li>
<li><b>Process execution results.</b></li>
</ol>
<h1><a class="anchor" id="github_add_secrets"></a>
Add GitHub Secrets</h1>
<p>Repository-specific <a href="https://docs.github.com/en/actions/security-guides/encrypted-secrets">GitHub Secrets</a> provide a useful mechanism that can be used for secure storage of sensitive AWS parameters required for running AVH Client.</p>
<p>The AWS environment parameters required for AVH Client are explained in <a class="el" href="avhclient.html#avhclient_setup_aws">AWS backend setup</a> and can be can be assigned to the repository secrets without exposing their values as shown in <a class="el" href="run_ami_github.html#github_add_workflow">Add GitHub Actions workflow</a>.</p>
<p>To create GitHub Secrets:</p><ul>
<li>Go to the GitHub webpage of your repository.</li>
<li>Go to <em>Settings</em> tab and in the list on the left side select <em>Secrets</em>.</li>
<li>Use button <em>New repository secret</em> and add one by required secrets.<ul>
<li>Make sure that the secret names used in environment setup step in <a class="el" href="run_ami_github.html#github_add_workflow">Add GitHub Actions workflow</a> are in synch with the names given at this step.</li>
</ul>
</li>
</ul>
<p>Note that when repository is forked, its secrets are not copied and need to be added to the forked repository again.</p>
<p>Find more information in GitHub documentation: <a href="https://docs.github.com/en/actions/reference/encrypted-secrets#creating-encrypted-secrets-for-a-repository">Creating encrypted secrets for a repository</a>.</p>
<h1><a class="anchor" id="github_avh_actions"></a>
Define AVH Actions</h1>
<p><em>AVH Actions</em> are the commands that get executed on the AVH AMI with AVH Client. They need to be described in a YAML specfile provided to the <code>avhclient execute</code> command. Typically the file would specify additional AWS parameters, list project files to be uploaded to the AVH AMI, describe commands to be executed, and list the files to be retrieved back. The file format is explained in <a class="el" href="avhclient.html#avhclient_yml">AVH YML file</a>.</p>
<p>Using AVH Client in a GitHub Actions workflow does not put additionally any specific requirements to the AVH Client specfile.</p>
<h1><a class="anchor" id="github_use_workflow"></a>
Use GitHub Actions workflow</h1>
<p>Once the GitHub Actions workflow is present in <code>.github/workflows/</code> directory, it will be triggered on the events defined in <a class="el" href="run_ami_github.html#github_add_workflow">Add GitHub Actions workflow</a>.</p>
<p>The details of the specific workflow run can be observed on the GitHub repository page under <em>Actions</em>. Find more information in GitHub documentation: <a href="https://docs.github.com/en/actions/learn-github-actions/understanding-github-actions#viewing-the-activity-for-a-workflow-run">Viewing the activity for a workflow run</a>.</p>
<p>For example for the <a href="../../examples/html/GetStarted.html">AVH-GetStarted project</a>:</p>
<div class="image">
<img src="View_GitHub-Actions.png" alt=""/>
<div class="caption">
View GitHub Action workflow</div></div>
     </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
	Copyright &copy; 2021-2023 Arm Limited (or its affiliates). All rights reserved.
	<!-- Use script below for auto-inserting date, project name, version, etc  -->
	<!-- <script type="text/javascript">
        writeFooter.call(this);
    </script> -->
    </li>
  </ul>
</div>
</body>
</html>
