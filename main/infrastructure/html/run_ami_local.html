<!-- HTML header for doxygen 1.9.2-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Infrastructure: Run AMI on Local Host</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="printComponentTabs.js"></script>
<script type="text/javascript" src="footer.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="$extra_stylesheet" rel="stylesheet" type="text/css" />
<link href="extra_stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 55px;">
  <td id="projectlogo" style="padding: 1em;"><img alt="Logo" src="arm.png"/></td>
  <td style="padding-left: 2em; padding-bottom: 1em;padding-top: 1em;">
   <div id="projectname">Virtual Hardware
   &#160;<span id="projectnumber">Version 0.2 - beta</span>
   </div>
   <div id="projectbrief">Infrastructure Service and Tool Integration</div>
  </td>
  <!--END !PROJECT_NAME-->
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<div id="Compnav" class="tabs1">
    <ul class="tablist">
      <script type="text/javascript">
		<!--
		writeComponentTabs.call(this);
		//-->
      </script>
	  </ul>
</div>
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('run_ami_local.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Run AMI on Local Host </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a class="anchor" id="md_src_aws"></a> This section describes how to run the <b>AMI with Arm Virtual Hardware</b> on a local host computer and assumes that have setup the <a class="el" href="index.html#AWS">AWS Marketplace</a>.</p>
<dl class="section note"><dt>Note</dt><dd>Refer to <a class="el" href="index.html#mainpage">Infrastructure</a> for others ways to use the Arm Virtual Hardware.</dd></dl>
<p>There are two was to launch the AMI:</p><ul>
<li><a class="el" href="run_ami_local.html#Launch_website">Launch from Website</a> gives direct access.</li>
<li><a class="el" href="run_ami_local.html#Launch_EC2">Launch trough EC2</a> gives you more control over the EC2 instance and is more flexible.</li>
</ul>
<p >Once the AMI is launched you may <a class="el" href="run_ami_local.html#connect">Connect to the EC2 Instance</a>.</p>
<dl class="section note"><dt>Note</dt><dd>Terminate the AMI instance once it is no longer required.</dd></dl>
<h1><a class="anchor" id="Launch_website"></a>
Launch from Website</h1>
<p >Before you can launch from a Website you should create a <b>VPC</b> and a <b>key pair</b>.</p>
<p >Choose the following settings:</p><ul>
<li><b>EC2 Instance Type:</b> <em>t3.medium</em> is sufficient to run Arm Virtual Hardware. An instance with more resources may improve performance.</li>
<li><b>VPC Settings:</b> select the VPC settings for the EC2 instance.</li>
<li><b>Key Pair Settings:</b> select your key.</li>
</ul>
<h1><a class="anchor" id="Launch_EC2"></a>
Launch trough EC2</h1>
<p >The following steps launch the <b>Arm Virtual Hardware AMI</b> from the AWS Console:</p>
<ol type="1">
<li><b>Choose AMI:</b> Select the <b>Arm Virtual Hardware</b> and click <b>Launch</b> (skip this step when you launch from marketplace).</li>
<li><b>Choose an Instance Type:</b> Select <em>t3.medium</em> (2 vCPUs, 4 GiB memory) is recommended. An instance with more resources may improve performance.</li>
<li><b>Configure Instance Details:</b> Under Network select a VPC. Note: a public IP address is required for SSH access. <br  />
</li>
<li><b>Add Storage:</b> The default storage 24 GiB is sufficient for most applications. Optionally, this can be increased if needed.</li>
<li><b>Add Tags:</b> This is optional, however adding the <b>Key=Name</b> with a meaningful <b>Value</b> helps you to identify the EC2 instance.</li>
<li><b>Configure Security Group:</b> Set Type: SSH, Protocol: TCP, Port Range: 22, Source: My IP (or Anywhere) to allow access from your IP address.</li>
<li><b>Review Instance Launch:</b> allows you to verify the setup. Then click <b>Launch</b></li>
</ol>
<p >You may then select an existing key pair or create a new key pair. When an existing key pair is selected, confirm in the dialog the check box <em>I acknowledge...</em>. To finally start, click <b>Launch Instances</b>.</p>
<p ><img src="select_existing_key.png" alt="" class="inline" title="Select key pair"/></p>
<h1><a class="anchor" id="connect"></a>
Connect to the EC2 Instance</h1>
<p >There are multiple ways to connect to the Amazon EC2 Linux instance that runs Arm VHT. For more information refer to:</p><ul>
<li><a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/AccessingInstances.html?icmpid=docs_ec2_console">Connect to your Linux instance</a></li>
</ul>
<h2><a class="anchor" id="use_ssh"></a>
Using SSH</h2>
<p >The connect via the Secure Shell (SSH) client of your computer, use the following command:</p>
<div class="fragment"><div class="line">$ ssh  -i &lt;path&gt;/your_key.pem ubuntu@&lt;Public IPv4 DNS&gt;</div>
</div><!-- fragment --><p> <b>Where:</b></p><ul>
<li><b>ssh</b> is the SSH command</li>
<li>option <b>-i</b> specifies the location of the AWS private key file that has the file extension *.pem.</li>
<li><b>ubuntu</b> is the user name of the Amazon EC2 Ubuntu Linux instance.</li>
<li><b>&lt;Public IPv4 DNS&gt;</b> is the public address typically in the format: ec2-*nn*-*nn*-*nn*-*nn*.compute-1.amazonaws.com</li>
</ul>
<p >You can review this details also under the AWS EC2 Management Console under <b>EC2 - Instances - &lt;select instance&gt; - Connect</b> and then select the tab <b>SSH Client</b>.</p>
<h2><a class="anchor" id="use_vnc"></a>
Using VNC</h2>
<p >Some applications may require a display. <a href="https://de.wikipedia.org/wiki/Virtual_Network_Computing">Virtual Network Computing</a> (VNC) is available in the Arm VHT AMI and can be used as a remote desktop.</p>
<p >First, setup VNC password. </p><div class="fragment"><div class="line">$ vncpasswd 0 i - </div>
</div><!-- fragment --><p> When prompted, enter a password. A read-only password is not required.</p>
<p >To start VNC every time the machine is rebooted enable it to start on boot: </p><div class="fragment"><div class="line">$ sudo systemctl enable vncserver@1.service</div>
</div><!-- fragment --><p> To start VNC now (1 time, without rebooting) use: </p><div class="fragment"><div class="line">$ sudo systemctl start vncserver@1.service</div>
</div><!-- fragment --><p> To disable VNC from running on future machine restarts run: </p><div class="fragment"><div class="line">$ sudo systemctl disable vncserver@1.service</div>
</div><!-- fragment --><p> To stop VNC now use: </p><div class="fragment"><div class="line">$ sudo systemctl stop vncserver@1.service</div>
</div><!-- fragment --><p> If VNC is running on the EC2 instance a VNC client can be used to connect. The easiest way to connect is by forwarding the VNC port using ssh. With this technique no additional ports need to be opened in the EC2 security group.</p>
<p >To connect use SSH port forwarding to avoid opening any other ports in the AWS security group </p><div class="fragment"><div class="line">$ ssh -i /path/to/aws.pem -L 5901:localhost:5901 ubuntu@@&lt;EC2-IP-addr&gt;</div>
</div><!-- fragment --><p >Open a VNC viewer, such as TigerVNC. Enter the VNC server as localhost:5901 and click Connect. It should ask for the previously set password and then present a remote desktop.</p>
<p ><img src="Connect_VNC.png" alt="" class="inline" title="Connect VNC Viewer"/></p>
<h2><a class="anchor" id="use_code_server"></a>
Using Code Server</h2>
<p >Code Server is automatically running on the AMI on port 8080. To connect use port forwarding to ssh into the EC2 instance. </p><div class="fragment"><div class="line">$ ssh -i /path/to/aws.pem -L 8080:localhost:8080 ubuntu@@&lt;EC2-IP-addr&gt;</div>
</div><!-- fragment --><p> Using a local browser connect to <a href="http://localhost:8080">http://localhost:8080</a> and you should see Visual Studio Code appear in the browser.</p>
<h1><a class="anchor" id="inventory"></a>
List AMI Inventory</h1>
<p >To obtain the list of tools installed in the AMI instance use:</p>
<div class="fragment"><div class="line">$ ./tool-inventory.sh</div>
</div><!-- fragment --><p >Following output shall be expected by default:</p>
<div class="fragment"><div class="line">ubuntu@ip-10-252-70-253:~$ ./tool-inventory.sh</div>
<div class="line">Product: ARM Compiler 6.16 Professional</div>
<div class="line">Component: ARM Compiler 6.16</div>
<div class="line">Tool: armclang [5dfeab00]</div>
<div class="line"> </div>
<div class="line">Target: arm-arm-none-eabi</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">GNU Compiler information:</div>
<div class="line">arm-none-eabi-gcc (GNU Arm Embedded Toolchain 10-2020-q4-major) 10.2.1 20201103 (release)</div>
<div class="line">Copyright (C) 2020 Free Software Foundation, Inc.</div>
<div class="line">This is free software; see the source for copying conditions.  There is NO</div>
<div class="line">warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">Corstone-300 FVP information:</div>
<div class="line"> </div>
<div class="line">Fast Models [11.16.26 (Dec  9 2021)]</div>
<div class="line">Copyright 2000-2021 ARM Limited.</div>
<div class="line">All Rights Reserved.</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">Info: /OSCI/SystemC: Simulation stopped by user.</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">Vela Compiler information:</div>
<div class="line">3.2.0</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">CMSIS build information:</div>
<div class="line">(cbuild.sh): Build Invocation 0.10.4 (C) 2021 ARM</div>
<div class="line">error: missing required argument &lt;project&gt;.cprj</div>
<div class="line">Usage:</div>
<div class="line">  cbuild.sh &lt;ProjectFile&gt;.cprj</div>
<div class="line">  [--toolchain=&lt;Toolchain&gt; --outdir=&lt;OutDir&gt; --intdir=&lt;IntDir&gt; &lt;CMakeTarget&gt;]</div>
<div class="line"> </div>
<div class="line">  &lt;ProjectFile&gt;.cprj      : CMSIS Project Description input file</div>
<div class="line">  --toolchain=&lt;Toolchain&gt; : select the toolchain</div>
<div class="line">  --intdir=&lt;IntDir&gt;       : set intermediate directory</div>
<div class="line">  --outdir=&lt;OutDir&gt;       : set output directory</div>
<div class="line">  --quiet                 : suppress output messages except build invocations</div>
<div class="line">  --clean                 : remove intermediate and output directories</div>
<div class="line">  --update=&lt;CprjFile&gt;     : generate &lt;CprjFile&gt; for reproducing current build</div>
<div class="line">  --help                  : launch documentation and exit</div>
<div class="line">  --log=&lt;LogFile&gt;         : save output messages in a log file</div>
<div class="line">  --jobs=&lt;N&gt;              : number of job slots for parallel execution</div>
<div class="line">  --cmake[=&lt;BuildSystem&gt;] : select build system, default &lt;BuildSystem&gt;=Ninja</div>
<div class="line">  &lt;CMakeTarget&gt;           : optional CMake target name</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">Arm Fast Models information:</div>
<div class="line">Fast Models</div>
<div class="line"> </div>
<div class="line">System Canvas 11.16.24  (Nov  4 2021)</div>
<div class="line">Copyright 2000-2021 ARM Limited.</div>
<div class="line">All Rights Reserved.</div>
<div class="line"> </div>
<div class="line">$PVLIB_HOME = /opt/FM/FastModelsPortfolio_11.16 (Version = 11.16.24)</div>
<div class="line"> </div>
<div class="line">Arm Virtual Hardware Targets:</div>
<div class="line">/opt/VHT/VHT_Corstone_SSE-300_Ethos-U55</div>
<div class="line">/opt/VHT/VHT_Corstone_SSE-300_Ethos-U65</div>
<div class="line">/opt/VHT/VHT_MPS2_Cortex-M0</div>
<div class="line">/opt/VHT/VHT_MPS2_Cortex-M0plus</div>
<div class="line">/opt/VHT/VHT_MPS2_Cortex-M23</div>
<div class="line">/opt/VHT/VHT_MPS2_Cortex-M3</div>
<div class="line">/opt/VHT/VHT_MPS2_Cortex-M33</div>
<div class="line">/opt/VHT/VHT_MPS2_Cortex-M4</div>
<div class="line">/opt/VHT/VHT_MPS2_Cortex-M7</div>
<div class="line">/opt/VHT/VHT_MPS3_Corstone_SSE-300</div>
</div><!-- fragment --><p >For the list of locally installed CMSIS Packs use:</p>
<div class="fragment"><div class="line">$ cp_list.sh</div>
</div><!-- fragment --><p >For example, default output on a new AMI instance would be:</p>
<div class="fragment"><div class="line">ubuntu@ip-10-252-70-253:~$ cp_list.sh</div>
<div class="line">Software packs are installed at: /home/ubuntu/packs</div>
<div class="line"> </div>
<div class="line">Currently installed software packs:</div>
<div class="line"> </div>
<div class="line">ARM.V2M_MPS2_SSE_300_BSP.1.0.0.pack</div>
<div class="line">ARM.CMSIS.5.7.0.pack</div>
</div><!-- fragment --><h1><a class="anchor" id="run_example"></a>
Running Micro Speech</h1>
<p >Run the micro speech example. Connect to the EC2 instance using ssh as described above and then get the example, compile, and run. </p><div class="fragment"><div class="line">$ git clone https://github.com/arm-software/VHT-TFLmicrospeech.git</div>
</div><!-- fragment --><p >For shared private projects your GitHub Username and Password key will be required to clone.</p>
<p >Navigate to the example directory: </p><div class="fragment"><div class="line">$ cd ./VHT-TFLmicrospeech/Platform_FVP_Corstone_SSE-300_Ethos-U55</div>
</div><!-- fragment --><p> Install the necessary CMSIS Packs (you may need to change permissions for the script): </p><div class="fragment"><div class="line">$ chmod 777 packlist.sh</div>
<div class="line">$ ./packlist.sh</div>
</div><!-- fragment --><p> Note that if this generated errors, you most likely have a legacy set up. Use this command to install packs instead: </p><div class="fragment"><div class="line">$ cp_install.sh packlist</div>
</div><!-- fragment --><p> Build the example: </p><div class="fragment"><div class="line">$ cbuild.sh microspeech.Example.cprj</div>
</div><!-- fragment --><p> When built, you can now run the example on the Virtual Hardware Target: </p><div class="fragment"><div class="line">$ ./run_example.sh</div>
</div><!-- fragment --><p> The output should display similar to: </p><div class="fragment"><div class="line">Fast Models [11.15.14 (Jun 23 2021)]</div>
<div class="line">Copyright 2000-2021 ARM Limited.</div>
<div class="line">All Rights Reserved.</div>
<div class="line"> </div>
<div class="line">telnetterminal0: Listening for serial connection on port 5000</div>
<div class="line">telnetterminal1: Listening for serial connection on port 5001</div>
<div class="line">telnetterminal2: Listening for serial connection on port 5002</div>
<div class="line">telnetterminal5: Listening for serial connection on port 5003</div>
<div class="line"> </div>
<div class="line">    Ethos-U rev f19bc8d4 --- Apr 23 2021 13:24:11</div>
<div class="line">    (C) COPYRIGHT 2019-2021 Arm Limited</div>
<div class="line">    ALL RIGHTS RESERVED</div>
<div class="line"> </div>
<div class="line">Heard yes (147) @1000ms</div>
<div class="line">Heard no (141) @5600ms</div>
<div class="line">Heard yes (149) @9100ms</div>
<div class="line">Heard no (142) @13600ms</div>
<div class="line">Heard yes (149) @17100ms</div>
<div class="line"> </div>
<div class="line">Info: Simulation is stopping. Reason: Cycle limit has been exceeded.</div>
<div class="line"> </div>
<div class="line">Info: /OSCI/SystemC: Simulation stopped by user.</div>
<div class="line">[warning ][main@0][01 ns] Simulation stopped by user</div>
<div class="line"> </div>
<div class="line">--- cpu_core statistics: ----------------------------------------------------</div>
<div class="line">Simulated time                          : 20.000002s</div>
<div class="line">User time                               : 396.865593s</div>
<div class="line">System time                             : 1.924400s</div>
<div class="line">Wall time                               : 398.550649s</div>
<div class="line">Performance index                       : 0.05</div>
<div class="line">cpu_core.cpu0                           :  10.03 MIPS (  4000000000 Inst)</div>
<div class="line">----------------------------------------------------------------------------</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
	Copyright &copy; 2021-2022 Arm Limited (or its affiliates). All rights reserved.
	<!-- Use script below for auto-inserting date, project name, version, etc  -->
	<!-- <script type="text/javascript">
        writeFooter.call(this);
    </script> -->
    </li>
  </ul>
</div>
</body>
</html>
