<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Get Started Example</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="extra_stylesheet.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="printComponentTabs.js"></script>
<script type="text/javascript" src="footer.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 55px;">
  <td style="padding: 1em;"id="projectlogo"><img alt="Logo" src="arm.png"/></td>
  <td style="padding-left: 2em; padding-bottom: 1em;padding-top: 1em;">
   <div id="projectname">Virtual Hardware
   &#160;<span id="projectnumber">Version 0.2 - beta</span>
   </div>
   <div id="projectbrief">Examples Projects and GitHub Repositories</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<div id="Compnav" class="tabs1">
    <ul class="tablist">
      <script type="text/javascript">
		<!--
		writeComponentTabs.call(this);
		//-->
      </script>
	  </ul>
</div>
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('GetStarted.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Get Started Example </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a class="anchor" id="md_src_GetStarted"></a> VHT Basic example demonstrates how to setup a Continuous Integration (CI) workflow for testing and debugging embedded applications using Arm Virtual Hardware (AVH). The project is maintained in the GitHub repository <a href="https://github.com/ARM-software/VHT-GetStarted/"><b>github.com/ARM-software/VHT-GetStarted</b></a> that also contains detailed description of the example.</p>
<p >This chapter provides step-by-step guide through the CI workflow operation and its setup.</p>
<h1><a class="anchor" id="GS_Overview"></a>
Overview</h1>
<p >The VHT Basic example implements common steps in the CI workflow as shown on the figure below and explained in subsequent sections.</p>
<p ><img src="basic_ci_workflow.png" alt="" class="inline" title="Continuous Integration (CI) workflow"/></p>
<ol type="1">
<li><a class="el" href="GetStarted.html#GS_DevelopTest">Local development</a>: at first, the software is developed locally using common embedded toolchain such as <a href="https://developer.arm.com/tools-and-software/embedded/keil-mdk">Keil MDK</a> and with <a href="../../simulation/html/index.html">Arm Virtual Hardware Target (VHT)</a> used for MCU simulation. <br  />
 A GitHub repository is used as a source code management system for synchronization, storage and version control.</li>
<li><a class="el" href="GetStarted.html#GS_SetupCI">CI pipeline setup</a>: a GitHub Action implements the CI pipeline that gets triggered on every code update in the repository.</li>
<li><a class="el" href="GetStarted.html#GS_ExecuteCI">CI execution</a>: automated program build and testing is performed in AVH cloud environment and results are reported back to the repository.</li>
<li><a class="el" href="GetStarted.html#GS_AnalyseFailure">Failure analysis and local debug</a>: developer can observe the CI test results in the GitHub Actions of the repository. In case of any failures they can be reproduced and debugged locally.</li>
</ol>
<h1><a class="anchor" id="GS_Prerequisites"></a>
Prerequisites</h1>
<p >Following is required to reproduce operation of the example project:</p>
<ul>
<li>a <a href="https://github.com/">GitHub</a> account</li>
<li>an <a href="https://aws.amazon.com/">AWS</a> account</li>
<li>a Windows PC with administrator rights</li>
</ul>
<p >Other necessary software items are freely available and their installation is described in the related steps.</p>
<h1><a class="anchor" id="GS_DevelopTest"></a>
Develop tests</h1>
<p >The VHT Basic embedded program implements a set of unit tests for validating operation of a simple function that is expected to return the sum value of two integer arguments. The example uses <a href="https://github.com/ThrowTheSwitch/Unity">Unity Framework</a> for test implementation and execution, however, the demonstrated concept is universal and can be applied for a different testing framework as well.</p>
<h2><a class="anchor" id="autotoc_md0"></a>
Create project repository on GitHub</h2>
<p >Initial repository setup should follow a standard git process for either <a href="https://docs.github.com/en/get-started/quickstart/create-a-repo">creating a new repo</a> or <a href="https://docs.github.com/en/get-started/quickstart/fork-a-repo">forking</a> already existing one. In this example we use a fork of the VHT GetStarted repository:</p><ul>
<li>Open a web browser and enter the URL: <a href="https://github.com/ARM-software/VHT-GetStarted">https://github.com/ARM-software/VHT-GetStarted</a></li>
<li>Verify that you are logged in to your GitHub account.</li>
<li>Click on <em>Fork</em> (upper right side).<ul>
<li>The repo gets forked into <code>`https://github.com/&lt;YourGitHubName&gt;/VHT-GetStarted`</code> repository, where <code>&lt;YourGitHubName&gt;</code> corresponds your GitHub user name.</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md1"></a>
Setup local project folder on your PC</h2>
<p >If the repo is present on GitHub, it can be easily copied onto local PC using following steps:</p><ul>
<li>Make sure Git Bash is installed on the PC. For example <a href="https://gitforwindows.org/">git for Windows</a>.</li>
<li>Open the Git Bash terminal in the target directory and execute clone command as: <pre class="fragment"> git clone https://github.com/&lt;YourGitHubName&gt;/VHT-GetStarted
</pre> </li>
</ul>
<h2><a class="anchor" id="autotoc_md2"></a>
Setup Keil MDK project</h2>
<ul>
<li>Install Keil MDK and related tools as described in <a href="../../infrastructure/html/run_mdk_pro.html#mdk_vht_install">Tools installation</a>.</li>
<li>In the local project repository double-click on the <em>basic/basic.debug.uvprojx</em> file to open the project in uVision IDE.</li>
<li>Verify the project setup as explained in <a href="../../infrastructure/html/run_mdk_pro.html#mdk_project_config">Project Configuration</a>.</li>
</ul>
<h2><a class="anchor" id="autotoc_md3"></a>
Implement tests locally</h2>
<p >The <em>main.c</em> file in the example implements a set of unit tests validating the application function <code>int my_sum(int a, int b)</code>. The implementation relies on the <a href="https://github.com/ThrowTheSwitch/Unity">Unity Framework</a> that is added to the example as a software component with the <a href="https://github.com/MDK-Packs/Pack/tree/master/Unity">Unity software pack</a>. In the example, the <code>test_my_sum_fail</code> demonstrates a test failure and section <a class="el" href="GetStarted.html#GS_AnalyseFailure">Analyse Failures</a> explains how to analyze CI output for debugging such failed tests.</p>
<p >The implementation of tests in the example can be considered as a template for adding more tests, covering other functions, or setting up unit testing in a custom project. Please refer to the documentation in <a href="https://github.com/ThrowTheSwitch/Unity">Unity GitHub</a> for further details and more complex examples.</p>
<p ><b>Redirect stdout</b></p>
<p >By default Unity uses <code>putchar</code> for print out. Keil MDK does not support semihosting and hence standard output needs to be redirected to become visible during debug session. <a href="https://www.keil.com/pack/doc/compiler/RetargetIO/html/index.html"><b>Redirect I/O</b></a> component enables several mechanisms for that. In our example this output gets redirected to a UART interface.</p>
<p ><b>Export project to CPRJ format</b></p>
<p >The VHT Basic project is also described in <em>basic.debug.cprj</em> file using universal <a href="https://arm-software.github.io/CMSIS_5/Build/html/cprjFormat_pg.html">.cprj format</a> that gets used in command-line CI environments. For correct workflow operation it is important to keep the MDK project files and the <em>basic.debug.cprj</em> file synchronized. For that after saving modifications in the MDK project go to the uVision menu <a href="https://www.keil.com/support/man/docs/uv4/uv4_ui_export.htm"><em>Project</em> - <em>Export</em></a> and select <em>Save project to CPRJ format</em>.</p>
<p ><b>Build and Run the example in Keil MDK</b></p>
<p >Build and execute the program in Keil MDK in the same way as any other project. Refer to <a href="../../infrastructure/html/run_mdk_pro.html#mdk_program_run">Program Build and Debug</a> for additional description.</p>
<p >In the VHT Basic example by default the following output shall be observed in the Telnet window, indicating an intentional failure in <code>test_my_sum_fail</code>:</p>
<p ><img src="basic_telnet_default.png" alt="" class="inline" title="Telnet output with local execution"/></p>
<h1><a class="anchor" id="GS_SetupCI"></a>
CI pipeline setup</h1>
<p >As common for many projects, the CI pipeline for the VHT Get Started repository is triggered on every code change via push and pull requests. In our example this is explicitly limited to the <em>main</em> branch only.</p>
<p >The CI implementation relies on <a href="https://docs.github.com/en/actions">GitHub Actions</a> with <a href="../../infrastructure/html/run_ami_github.html#GitHub_hosted">GitHub-hosted Runners</a>. Program build and execution are done on <a href="../../infrastructure/html/index.html#AWS">AVH AMI</a> instance in Amazon AWS. Custom GitHub action <a href="https://github.com/ARM-software/VHT-AMI">Arm-Software/VHT-AMI</a> manages the connection between the GitHub repository and the AVH AMI instance in AWS, as well as configures the actions to be performed on the AMI.</p>
<p >Subsections below explain the setup for the AWS and GitHub Actions.</p>
<h2><a class="anchor" id="autotoc_md4"></a>
AWS setup</h2>
<p >On the AWS side several items shall be setup to enable execution of example CI pipeline on AVH AMI.</p>
<ul>
<li>Enable use of AVH AMI in your AWS account with the steps described in <a href="../../infrastructure/html/index.html#Subscribe">Subscribe Arm Virtual Hardware</a>.</li>
<li>Provision the AWS resources required for AVH AMI operation.<ul>
<li>The simplest way is explained in <a href="https://github.com/spcaipers-arm/VHT-AWS-Infra-CloudFormation">AVH-AWS-Infra-CloudFormation</a> and relies on AWS CloudFormation service with the template file describing default stack configuration.</li>
<li>Alternatively, for a more customized setup see <a href="../../infrastructure/html/run_ami_github.html#GitHub_hosted">GitHub-hosted Runners</a>.</li>
</ul>
</li>
<li>Ensure that a Key Pair is available for use with EC2.<br  />
 By default the VHT Basic example expects a key pair with name <code>common</code> to create an EC2 instance (with line <code>ssh_key_name: common</code> in <em>basic.yml</em> file).<ul>
<li>In AWS Management Console type <em>EC2</em> and go to the EC2 service.</li>
<li>In the left menu find <em>Network &amp; Security</em> section and click on <em>Key Pairs</em>.</li>
<li>Verify that the same AWS region is selected as will be used with AVH AMI later.</li>
<li>If no <code>common</code> key pair exists then click on <em>Create key pair</em> button. <br  />
 <img src="basic_ec2_keypair_overview.png" alt="" class="inline" title="AWS EC2 Key Pair view"/><br  />
</li>
<li>In the <em>Create key pair</em> dialog provide <code>common</code> as <em>Name</em>. Other settings can be kept at default values.</li>
<li>Click on <em>Create key pair</em>.</li>
<li>Save the file with the private key locally when corresponding file dialog opens. <br  />
 <img src="basic_ec2_keypair_create.png" alt="" class="inline" title="AWS EC2 Key Pair create"/></li>
<li>Observe the created Key Pair appear in the list.</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md5"></a>
GitHub Actions setup</h2>
<p >Section <a href="../../infrastructure/html/run_ami_github.html#GitHub_hosted">GitHub-hosted Runners</a> introdues the concept and explains it in details.</p>
<p ><a href="https://github.com/ARM-software/VHT-GetStarted/blob/main/.github/workflows/basic.yml">./.github/workflows/basic.yml</a> file using corresponding <a href="https://docs.github.com/en/actions/learn-github-actions/workflow-syntax-for-github-actions">YAML syntax for GitHub workflows</a>.</p>
<p >todo: explain GitHub setup</p>
<h1><a class="anchor" id="GS_ExecuteCI"></a>
Execute CI</h1>
<p >CI pipeline gets executed automatically on every code change in the <em>main</em> branch and execution results can be observed on the repository GitHub page.</p>
<ul>
<li>Go to the GitHub web-page of the repository.</li>
<li>Go to <em>Actions</em> tab.<ul>
<li>In <em>Workflows</em> area you can see the list of GitHub workflows defined in the repository. In our example it is just one.</li>
</ul>
</li>
<li>Select the workflow and its executions will be displayed on the page. An icon before the title of each run indicates whether CI pipeline execution was successfully or not. A failure indicates an issue in CI<ul>
<li>With <em>Run workflow</em> you can manually trigger execution of this workflow on the current codebase. <img src="basic_gh_actions.png" alt="" class="inline" title="GitHub Actions view"/></li>
</ul>
</li>
<li>Click on the title of a workflow run to analyze its execution as explained in next section.</li>
</ul>
<h1><a class="anchor" id="GS_AnalyseFailure"></a>
Analyse Failures</h1>
<p ><a href="https://docs.github.com/en/actions/monitoring-and-troubleshooting-workflows/about-monitoring-and-troubleshooting">GitHub Documentation</a> gives an overview about monitoring and troubleshooting options available for GitHub Actions.</p>
<p >The VHT Basic example workflow executes three CI jobs as visible in the <em>Jobs</em> area on the left side. By default it appears as follows:</p>
<p ><img src="basic_gh_workflow_jobs_default.png" alt="" class="inline" title="GitHub Actions workflow jobs "/></p>
<ul>
<li><b>ci_test</b> job executes the CI pipeline without doing any analysis of unit test results. It is considered as successful (green circle) when the CI pipeline was executed fully to the end.</li>
<li><b>badge</b> job generates <a href="https://docs.github.com/en/actions/monitoring-and-troubleshooting-workflows/adding-a-workflow-status-badge">GitHub badges</a> for the <em>README.md</em> file to make the CI workflow status easily visible. The <em>badge</em> job is shown as successful when badge generation worked correctly.</li>
<li><b>Test results</b> job analyses actual results of the unit test execution in the CI. Green checkmark indicates that all executed tests pass.</li>
</ul>
<p >In the <em>Artifacts</em> area click on <em>results</em> to download an archive file with additional details about the test run. It contains:</p><ul>
<li><em>basic.axf</em> binary image that was built and tested in the CI run.</li>
<li>*.log* file with program execution output.</li>
<li>*.xunit* file with unit test results.</li>
</ul>
<p >Click on <em>ci_test</em> or <em>badge</em> jobs to open corresponding <a href="https://docs.github.com/en/actions/monitoring-and-troubleshooting-workflows/using-workflow-run-logs">run log</a> that can be explored for execution details. For example for <em>ci_test</em>:<br  />
 <img src="basic_gh_ci_test_log.png" alt="" class="inline" title="GitHub Actions workflow log example"/></p>
<ul>
<li>Click on <em>Test results</em> job that analyses the results of the executed tests. It can be seen that in default setup 1 out of 4 tests fails. Specific location (<em>check on line 48 in main.c</em>) and the reason (<em>Expected 2 Was 0</em>) for the failure are shown as well.<br  />
 <img src="basic_gh_test_results_view.png" alt="" class="inline" title="GitHub Actions test results view"/></li>
</ul>
<p >This allows to find the failure quickly. In our example it is a trivial one, introduced on purpose in the original code.</p><ul>
<li>Return to the VHT Basic project in Keil MDK on your PC.</li>
<li>Open <em>main.c</em> file.</li>
<li>In line 48 replace the incorrectly expected value <code>2</code> with the correct <code>0</code>: <pre class="fragment">  TEST_ASSERT_EQUAL_INT(0, sum);
</pre></li>
<li>Rebuild the project.</li>
<li>Start debug session and observe in Telnet client that all tests pass: <br  />
 <img src="basic_telnet_success.png" alt="" class="inline" title="Telnet output of successful execution"/><br  />
</li>
<li>Export the project to .cprj format to ensure it is synchronized with the MDK project. In this case no changes are .</li>
<li>Open the Git bash in your local repository and execute following commands that upload only the updated <em>main.c</em> file to your <em>main</em> repository: <pre class="fragment">  git commit basic/main.c -m "Fixed test_my_sum_fail"
  git push
</pre></li>
<li>Go to GitHub Actions page of your repository.</li>
<li>Observe that the CI workflow was automatically started with the code change. After sometime it gets completed and now the <em>Test results</em> job shall indicate that were no test failures.<br  />
 <img src="basic_gh_test_results_success.png" alt="" class="inline" title="GitHub Actions test results view"/> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
	Copyright &copy; 2021 Arm Limited (or its affiliates). All rights reserved.
	<!-- Use script below for auto-inserting date, project name, version, etc  -->
	<!-- <script type="text/javascript">
        writeFooter.call(this);
    </script> -->
    </li>
  </ul>
</div>
</body>
</html>
