<!-- HTML header for doxygen 1.9.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AVH FVP models: Video via VSI</title>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="extra_navtree.css" rel="stylesheet" type="text/css"/>
<link href="extra_stylesheet.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="printComponentTabs.js"></script>
<script type="text/javascript" src="footer.js"></script>
<script type="text/javascript" src="toc.js"></script>
<script type="text/javascript">
  DoxygenAwesomeInteractiveToc.init()
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<script type="text/javascript" src="darkmode_toggle.js"></script>
<link href="extra_stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="extra_navtree.css" rel="stylesheet" type="text/css"/>
<link href="extra_search.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow" style="height: 55px;">
  <td id="projectlogo" style="padding: 1em;"><img alt="Logo" src="arm.png"/></td>
  <td style="padding-left: 2em; padding-bottom: 1em;padding-top: 1em;">
   <div id="projectname">Arm Virtual Hardware
   &#160;<span id="projectnumber">Version 2.1.0</span>
   </div>
   <div id="projectbrief">AVH FVP Models</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<div id="Compnav" class="tabs1">
    <ul class="tablist">
      <script type="text/javascript">
		<!--
		writeComponentTabs.call(this);
		//-->
      </script>
	  </ul>
</div>
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('group__arm__vsi__video.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#groups">Content</a> &#124;
<a href="#nested-classes">Data Structures</a>  </div>
  <div class="headertitle"><div class="title">Video via VSI<div class="ingroups"><a class="el" href="group__arm__vsi.html">Virtual Streaming Interface (VSI)</a> &raquo; <a class="el" href="group__arm__vsi__cases.html">VSI Use Cases</a></div></div></div>
</div><!--header-->
<div class="contents">

<p>Video file streaming interface.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="groups" name="groups"></a>
Content</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__video__drv__functions.html">Video Driver API Functions</a></td></tr>
<tr class="memdesc:group__video__drv__functions"><td class="mdescLeft">&#160;</td><td class="mdescRight">Video Driver API functions. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__video__drv__defines.html">Video Driver API Defines</a></td></tr>
<tr class="memdesc:group__video__drv__defines"><td class="mdescLeft">&#160;</td><td class="mdescRight">Video Driver API Definitions. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:structVideoDrv__Status__t" id="r_structVideoDrv__Status__t"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#structVideoDrv__Status__t">VideoDrv_Status_t</a></td></tr>
<tr class="memdesc:structVideoDrv__Status__t"><td class="mdescLeft">&#160;</td><td class="mdescRight">Video Status.  <a href="#structVideoDrv__Status__t">More...</a><br /></td></tr>
<tr class="separator:structVideoDrv__Status__t"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Description</h2>
<p>Video file streaming interface. </p>
<p>Video streaming use case is implemented for AVH FVPs based on the general-purpose <a class="el" href="group__arm__vsi.html">Virtual Streaming Interface (VSI)</a>.</p>
<p>The use of generic <a class="el" href="group__video__drv__functions.html">Video Driver APIs</a> simplifies re-targeting of the application code between virtual and physical devices.</p>
<p>The video driver implementation for AVH FVPs relies on the <a class="el" href="group__arm__vsi__api.html">VSI peripheral API</a> with an interface to the python scripts. For video use case the python scripts access local video or image files as streaming input/output. Alternatively, PC's camera can be used as video input and PC's display as video output.</p>
<p>The operation of the video driver follows the principles used in the drivers for real hardware: application should configure the driver with such parameters as resolution, frame rate, color scheme. Additionally it specifies the local input/output file name or defaults to webcam input. Then the application controls the video stream / frame extraction from the peripheral.</p>
<p>The concept is shown on the figure below for input and optional output streams:</p><ul>
<li>An input flow uses a local video input and relies on the VSI python API (arm_vsi4.py) as well as additional submodules (vsi_video.py, vsi_video_server.py) to adjust the stream configuration based on the paratemeters specified by the application firmware and to deliver the frames into the application for ML-Processing.</li>
<li>After that, post-processing can be applied to the image (for example box-drawing for detected object) and then sent to the output stream.</li>
</ul>
<p>Additional details are provided in <a class="el" href="#video_vsi_detail">Operation details</a>.</p>
<div class="image">
<img src="vsi_video_structure.png" alt=""/>
<div class="caption">
Video VSI Implementation Overview</div></div>
<h2><a class="anchor" id="autotoc_md6"></a>
Python requirements</h2>
<p>In addition to the requirements listed in <a class="el" href="group__arm__vsi__pyenv.html">Python environment setup</a>, the VSI Video use case also requires installed OpenCV Python package. Run the following command to install it with pip: </p><div class="fragment"><div class="line">pip install opencv-python</div>
</div><!-- fragment --><h2><a class="anchor" id="video_vsi_detail"></a>
Operation details</h2>
<p>The table below lists the files that implement the video over VSI peripheral:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Item   </th><th class="markdownTableHeadLeft">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><a href="https://github.com/ARM-software/AVH/blob/main/interface/video/include/video_drv.h">./interface/video/include/video_drv.h</a>   </td><td class="markdownTableBodyLeft"><a class="el" href="group__arm__vsi__video.html">Video Driver API</a> header file. Used by implementations on AVH FVPs and real HW boards.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><a href="https://github.com/ARM-software/AVH/blob/main/interface/video/source/video_drv.c">./interface/video/source/video_drv.c</a>   </td><td class="markdownTableBodyLeft">Video driver implementation for AVH FVPs.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><a href="https://github.com/ARM-software/AVH/blob/main/interface/video/python/arm_vsi4.py">./interface/video/python/arm_vsi4.py</a>   </td><td class="markdownTableBodyLeft"><a class="el" href="group__arm__vsi__video.html">Video via VSI</a> Python script for video input channel 0.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><a href="https://github.com/ARM-software/AVH/blob/main/interface/video/python/arm_vsi5.py">./interface/video/python/arm_vsi5.py</a>   </td><td class="markdownTableBodyLeft"><a class="el" href="group__arm__vsi__video.html">Video via VSI</a> Python script for video output channel 0.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><a href="https://github.com/ARM-software/AVH/blob/main/interface/video/python/arm_vsi6.py">./interface/video/python/arm_vsi6.py</a>   </td><td class="markdownTableBodyLeft"><a class="el" href="group__arm__vsi__video.html">Video via VSI</a> Python script for video input channel 1.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><a href="https://github.com/ARM-software/AVH/blob/main/interface/video/python/arm_vsi7.py">./interface/video/python/arm_vsi7.py</a>   </td><td class="markdownTableBodyLeft"><a class="el" href="group__arm__vsi__video.html">Video via VSI</a> Python script for video output channel 1.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><a href="https://github.com/ARM-software/AVH/blob/main/interface/video/python/vsi_video.py">./interface/video/python/vsi_video.py</a>   </td><td class="markdownTableBodyLeft">VSI video client module.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><a href="https://github.com/ARM-software/AVH/blob/main/interface/video/python/vsi_video_server.py">./interface/video/python/vsi_video_server.py</a>   </td><td class="markdownTableBodyLeft">VSI video server module.   </td></tr>
</table>
<p>The execution flow for video input on channel 0 is explained in the diagram below:</p>
<div class="image">
<img src="using_video_vsi_uml.png" alt=""/>
<div class="caption">
Sequence diagram for the Video over VSI implementation</div></div>
<ol type="1">
<li>Upon start/reset of the FVP model the VSI peripheral calls <a class="el" href="group__arm__vsi__py.html#ga4be4055f3361d4800e16bc2e2e38cda6">init()</a> function in the available VSI Python API files. In this example, for video input on channel 0 it is arm_vsi4.py. The init() function then starts video server on the host.</li>
<li>User application on the device calls <a class="el" href="group__video__drv__functions.html#ga5fd938d5ff84b46771e2a8a3d0a73cfe">VideoDrv_Initialize</a> that configures the available channels on the driver into default state.</li>
<li>Then <a class="el" href="group__video__drv__functions.html#ga6ad4d20e1dea6332fabe53710023957e">VideoDrv_Configure</a> is used to specify required parameters for the input stream such as resolution, color scheme, and frame rate. The driver propagates this configuration to the video server, and also sets the DMA and the Timer for the VSI peripheral according to that configuration.</li>
<li>With <a class="el" href="group__video__drv__functions.html#ga75f42edad029c1670eb55c837e14548c">VideoDrv_SetBuf</a> a DMA buffer is assigned to be used for incoming data.</li>
<li><a class="el" href="group__video__drv__functions.html#gae7bed6c8b6e83eef0ef54f510a3c948a">VideoDrv_SetFile</a> specifies the input file. If the file is not found then an error will be returned.</li>
<li>After that application initiates the streaming with <a class="el" href="group__video__drv__functions.html#ga0d74405efb2075a59ed51e0da42cc988">VideoDrv_StreamStart</a>. This opens selected file, and also configures VSI timer and enables VSI IRQ.</li>
<li>With step 6 completed, a loop of frame reading is started:<ul>
<li>A frame is read from the file, and is prepared according to the stream configuration (with crop/resize and color change operations done in the vsi_video_server.py).</li>
<li>The processed frame data is copied to the DMA buffer.</li>
<li><a class="el" href="group__video__drv__functions.html#ga963660475d743daa2f2ae1a87d409f3a">VideoDrv_GetStatus</a> checks if the frame buffer is full, meaning that a complete frame was transferred to the FVP memory. An approach with asynchronous video driver event <a class="el" href="group__video__drv__events.html#gac39f1c6884638f4b1e341732bd4861a7">VIDEO_DRV_EVENT_FRAME</a> can be used as well.</li>
<li>When video buffer is filled, we can extract the frame from it using <a class="el" href="group__video__drv__functions.html#ga0084bec78863eed1ccaaff29499e59bc">VideoDrv_GetFrameBuf</a>.</li>
<li>Obtained frame can be now passed to the processing algorithm (for example for object detection).</li>
<li>Release the frame with <a class="el" href="group__video__drv__functions.html#ga034fdbb82c1133e8fa0c15a3e0085166">VideoDrv_ReleaseFrame</a> to enable reception of the next frame.</li>
<li>Repeat the steps above until end of stream is reported in the status.</li>
</ul>
</li>
<li>When the end of the stream is reached, we can close the stream with <a class="el" href="group__video__drv__functions.html#ga1f88af1f66776ec9cf661bbdcaf268cd">VideoDrv_StreamStop</a> and stop driver operation with <a class="el" href="group__video__drv__functions.html#ga671a4ef5b5e1f24342a933013994e842">VideoDrv_Uninitialize</a>. </li>
</ol>
<hr/><h2 class="groupheader">Data Structure Documentation</h2>
<a name="structVideoDrv__Status__t" id="structVideoDrv__Status__t"></a>
<h2 class="memtitle"><span class="permalink"><a href="#structVideoDrv__Status__t">&#9670;&#160;</a></span>VideoDrv_Status_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct VideoDrv_Status_t</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="textblock"><p>Video Status. </p>
<p>Structure with information about the Video channel status. The data fields encode active and buffer state flags.</p>
<p><b>Returned by:</b></p><ul>
<li><a class="el" href="group__video__drv__functions.html#ga963660475d743daa2f2ae1a87d409f3a">VideoDrv_GetStatus</a> </li>
</ul>
</div><table class="fieldtable">
<tr><th colspan="3">Data Fields</th></tr>
<tr><td class="fieldtype">
<a id="ab22b96a3efad48f5a542f46c1b224800" name="ab22b96a3efad48f5a542f46c1b224800"></a>uint32_t</td>
<td class="fieldname">
active: 1</td>
<td class="fielddoc">
Video stream active. </td></tr>
<tr><td class="fieldtype">
<a id="ac644e277e4294dfe0f43640cbce9ddbe" name="ac644e277e4294dfe0f43640cbce9ddbe"></a>uint32_t</td>
<td class="fieldname">
buf_empty: 1</td>
<td class="fielddoc">
Video buffer empty. </td></tr>
<tr><td class="fieldtype">
<a id="a2a19de3146543c3c35844519913ed2de" name="a2a19de3146543c3c35844519913ed2de"></a>uint32_t</td>
<td class="fieldname">
buf_full: 1</td>
<td class="fielddoc">
Video buffer full. </td></tr>
<tr><td class="fieldtype">
<a id="a0cf5238d77dfd26667ab7509476ba6ef" name="a0cf5238d77dfd26667ab7509476ba6ef"></a>uint32_t</td>
<td class="fieldname">
overflow: 1</td>
<td class="fielddoc">
Video buffer overflow (cleared on GetStatus) </td></tr>
<tr><td class="fieldtype">
<a id="a91203e7151825fa5a14fc617ca2c9af3" name="a91203e7151825fa5a14fc617ca2c9af3"></a>uint32_t</td>
<td class="fieldname">
underflow: 1</td>
<td class="fielddoc">
Video buffer underflow (cleared on GetStatus) </td></tr>
<tr><td class="fieldtype">
<a id="a9944b95531e6277ab19a6c85e3c66cfa" name="a9944b95531e6277ab19a6c85e3c66cfa"></a>uint32_t</td>
<td class="fieldname">
eos: 1</td>
<td class="fielddoc">
Video end of stream (cleared on GetStatus) </td></tr>
<tr><td class="fieldtype">
<a id="aa43c4c21b173ada1b6b7568956f0d650" name="aa43c4c21b173ada1b6b7568956f0d650"></a>uint32_t</td>
<td class="fieldname">
reserved: 26</td>
<td class="fielddoc">
</td></tr>
</table>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
	Copyright &copy; 2021-2023 Arm Limited (or its affiliates). All rights reserved.
	<!-- Use script below for auto-inserting date, project name, version, etc  -->
	<!-- <script type="text/javascript">
        writeFooter.call(this);
    </script> -->
    </li>
  </ul>
</div>
</body>
</html>
