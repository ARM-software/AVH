<!-- HTML header for doxygen 1.9.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AVH FVP models: Useful Hints and Tips</title>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="extra_navtree.css" rel="stylesheet" type="text/css"/>
<link href="extra_stylesheet.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="printComponentTabs.js"></script>
<script type="text/javascript" src="footer.js"></script>
<script type="text/javascript" src="toc.js"></script>
<script type="text/javascript">
  DoxygenAwesomeInteractiveToc.init()
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<script type="text/javascript" src="darkmode_toggle.js"></script>
<link href="extra_stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="extra_navtree.css" rel="stylesheet" type="text/css"/>
<link href="extra_search.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow" style="height: 55px;">
  <td id="projectlogo" style="padding: 1em;"><img alt="Logo" src="arm.png"/></td>
  <td style="padding-left: 2em; padding-bottom: 1em;padding-top: 1em;">
   <div id="projectname">Arm Virtual Hardware
   &#160;<span id="projectnumber">Version 2.1.0</span>
   </div>
   <div id="projectbrief">AVH FVP Models</div>
  </td>
  <!--END !PROJECT_NAME-->
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<div id="Compnav" class="tabs1">
    <ul class="tablist">
      <script type="text/javascript">
		<!--
		writeComponentTabs.call(this);
		//-->
      </script>
	  </ul>
</div>
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('hints.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Useful Hints and Tips </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_src_hints_and_tips"></a> Below are some useful tips for using FVP models in common AVH scenarios:</p>
<ul>
<li><a class="el" href="hints.html#console">Terminal output and logging</a></li>
<li><a class="el" href="hints.html#ci_frameworks">Execution in CI frameworks</a></li>
<li><a class="el" href="hints.html#timing">Execution timing</a></li>
<li><a class="el" href="hints.html#stop">Execution stop</a></li>
</ul>
<h1><a class="anchor" id="console"></a>
Terminal output and logging</h1>
<p>Application can use following options for printing information to a console:</p><ul>
<li><a class="el" href="hints.html#uart">UART I/O</a></li>
<li><a class="el" href="hints.html#semihosting">Semihosting I/O</a></li>
</ul>
<h2><a class="anchor" id="uart"></a>
UART I/O</h2>
<p>The application firmware can use UART channels available in the FVP model to print out information, with data being forwarded to a Telnet terminal on the PC via a local TCP/IP connection.</p>
<p>This approach is especially beneficial for full-stack applications that also run on real hardware with UART communication and so can keep uniform structure for virtual and real targets.</p>
<p>Below is useful information for using UART I/O on FVP targets:</p>
<ul>
<li><b>Concept</b>: <a href="https://developer.arm.com/documentation/100966/latest/Getting-Started-with-Fixed-Virtual-Platforms/Using-a-terminal-with-an-FVP">Using-a-terminal-with-an-FVP</a> and <a href="https://developer.arm.com/documentation/100964/1126/Fast-Models-components/Peripheral-components/TelnetTerminal">TelnetTerminal</a> explain the concept in details.</li>
<li><b>UART Drivers</b>: CMSIS BSP packs listed in <a class="el" href="avh_fvp_cmsis.html">CMSIS-based projects for AVH FVPs</a> contain drivers for UART access on corresponding FVP targets.</li>
<li><b>Retarget to UART</b>: <a href="https://arm-software.github.io/CMSIS_6/latest/Compiler/index.html">CMSIS-Compiler component</a> implements retargeting of standard output functions, such as <code>printf()</code>.</li>
<li><b>FVP parameters</b>: the default values of FVP configuration parameters related to UART and Telnet should already work correctly. Refer to the FVP and Fast Models documentation as well as reference examples for additional information.</li>
<li><b>Windows setup</b> : On Windows you need to enable Telnet, as follows:<ul>
<li>Open <em>Start</em> &gt; <em>Settings</em>.</li>
<li>In the search box, type <em>Turn Windows features on or off</em> and click on the suggested item. The <em>Windows Features</em> dialog opens.</li>
<li>Select the <em>Telnet Client</em> check box and click <em>OK</em>. The installation might take several minutes to complete.</li>
</ul>
</li>
<li><b>Linux setup</b> : on Linux both <code>xterm</code> and <code>telnet</code> must be installed and be specified in your PATH.</li>
<li><b>Logging</b> : If a UART output needs to be saved as a log file (for example in CI tests), you can use FVP parameter <code>&lt;board&gt;.&lt;uart&gt;.out_file</code> to specify the log file. For example for UART0 on Corstone-315: <code>msp4_board.UART0.out_file=./log.txt</code>.<ul>
<li>If displaying the ouput information in an output terminal is not required (for example in CI jobs) you can disable it with FVP configuration parameter <code>&lt;board&gt;.&lt;telnetterminal&gt;.start_telnet</code>. For example for Corsone-315 and UART0: <code>msp4_board.telnetterminal0.start_telnet=0</code>. In this case the output will not be displayed in any terminal, but will be stored into a log file if this is configured accordingly with the <code>out_file</code> parameter.</li>
</ul>
</li>
<li><b>Multiple channels</b>: in complex systems and applications it can be beneficial to separate output into different UART channels and hence terminals, to avoid cluttered messages in a single terminal.</li>
<li><b>Example</b> : <a href="https://github.com/Arm-Examples/AVH-Hello">AVH-Hello</a> provides a universal example with UART output, covering all AVH FVP targets.</li>
</ul>
<h2><a class="anchor" id="semihosting"></a>
Semihosting I/O</h2>
<p>Application can also rely on the semihosting mechanism that enables the code running on an FVP model to direcly use the Input/Output facilities of the host computer. With semihosting we can enable standard C I/O functions, such as <code>printf()</code> and <code>scanf()</code>, to use the host terminal from where the model is started.</p>
<p>Semihosting approach can be useful to quickly enable terminal communication and bypass the complexity of using UART and I/O retargeting. It also helps to achieve a simpler implementation for rather CPU-centric test suites with unit testing, module testings and API testing that need to be run on various CPUs and with different compilers.</p>
<p>Below is useful information for using semihosting for terminal output on FVP targets:</p>
<ul>
<li><b>Concept</b>: <a href="https://developer.arm.com/documentation/101470/2024-0/Controlling-Target-Execution/Using-semihosting-to-access-resources-on-the-host-computer">Using semihosting</a> gives a good overview and references about semihosting on Arm targets. It is a part of Arm Development Studio documenation, and contains additional details for that environment.</li>
<li><b>FVP parameters</b>: by default semihosting is disabled in FVPs and needs to be enabled with <code>semihosting-enable</code> configuration parameter on the CPU instance. For example for FVP_Corstone_SSE-3xx as <code>cpu0.semihosting-enable=1</code> and for FVP_MPS2_Cortex-M4 as <code>armcortexm4ct.semihosting-enable=1</code>.</li>
<li><b>GCC support</b>: special considerations are required when using firmware built with GCC toolchain:<ul>
<li>you need to set the spec strings file in Linker options as <code>--specs=rdimon.specs</code> to use the semihosted version of the syscalls.</li>
<li>when running a project built using GCC and CMSIS, the semihosting implementation can overwrite the memory configuration. To avoid this problem, configure the required values for stack and heap using model parameters, as described in this Knowledge Base Article <a href="https://developer.arm.com/documentation/ka005824/">How do I Avoid Stack Pointer Corruption When Semihosting is Enabled on a GCC Toolchain?</a>.</li>
</ul>
</li>
<li><b>Logging</b>: to store the semihosted output simply redirect the terminal output of the FVP execution to a log file, using standard mechanisms provided by corresponding console, such as <code>tee</code> in Linux or <code>&gt;</code> in bash.</li>
<li><b>Examples</b>:<ul>
<li><a href="https://github.com/ARM-software/CMSIS_6/tree/main/CMSIS/CoreValidation">CMSIS-Core Validation</a> project implements tests suite for CMSIS-Core using semihosting-based print outs. FVP configuration file can be found in <a href="https://github.com/ARM-software/CMSIS_6/tree/main/CMSIS/CoreValidation/Layer/Target">/Layer/Target</a> folder for respective target, as <code>model-config.txt</code>.</li>
<li><a href="https://github.com/ARM-software/CMSIS-FreeRTOS/tree/main/CMSIS/RTOS2/FreeRTOS/Examples">CMSIS-FreeRTOS Examples</a> contain simple "hello world" style applications that use semihosting for print-outs.</li>
</ul>
</li>
</ul>
<p>Semihosting is also required for the following use cases:</p>
<ul>
<li>With <a href="https://github.com/ARM-software/CMSIS-View">CMSIS-View</a> component to store the events and execution times into a log file on the host machine. See more in <a href="https://arm-software.github.io/CMSIS-View/main/er_use.html#er_semihosting">Event Recorder semihosting</a>.</li>
<li>With <a class="el" href="group__arm__vsocket.html">Virtual Socket Interface (VSocket)</a> for using the internet connectivity of the host machine.</li>
</ul>
<h1><a class="anchor" id="ci_frameworks"></a>
Execution in CI frameworks</h1>
<p>Chapter <a href="./../../infrastructure/html/index.html">Infrastructure</a> explains how AVH FVPs and other related tools can be programatiically installed into various Continuous Integraion (CI) frameworks, such as GitHub. To execute your programs on AVH FVPs in such workflows following is important:</p>
<ul>
<li>Disable GUI visualisation, as it often is not supported by a host and not needed in CI testing:<ul>
<li>Set FVP configuration parameter <code>&lt;board&gt;.visualisation.disable-visualisation=1</code> for the board instance on the target FVP. For example for Corstone-315 FVP it should be <code>mps4_board.visualisation.disable-visualisation=1</code>.</li>
<li>For targets with HDLCD such as Corstone-315 FVP, additionally disable the visualisation for HDLCD as <code>vis_hdlcd.disable_visualisation=1</code>.</li>
</ul>
</li>
<li>Redirect the console outputs to a log file as explained in <a class="el" href="hints.html#console">Terminal output and logging</a>.</li>
<li>Ensure the program execution is exited when required by the test. <a class="el" href="hints.html#stop">Execution stop</a> explains options for such exit.</li>
<li>For simpler implementation a matrix-style job configuration configuration can be used. See for example <a href="./../../infrastructure/html/avh_gh_actions.html#avh_gh_matrix">Running multiple configurations with GitHub Actions</a>.</li>
</ul>
<h1><a class="anchor" id="timing"></a>
Execution timing</h1>
<p>FVP simulation models are targeted to software development and functional testing, and are not suitable for accurate performance comparisons on the CPU level. However, they can be well used to analyze timing on the program level, such as for scheduling RTOS tasks, detecting deadlocks, but also identifying overall performance trends.</p>
<p>Following mechanisms and settings can be used for timing control and measurements:</p>
<ul>
<li><p class="startli">FVP model can be started with command-line option <code>--stat</code> to print the execution statistics on simulation exit. Here is an example of such statistics output: </p><div class="fragment"><div class="line">--- cpu_core statistics: ------------------------------------------------------</div>
<div class="line">Simulated time                          : 0.651964s</div>
<div class="line">User time                               : 0.843750s</div>
<div class="line">System time                             : 0.109375s</div>
<div class="line">Wall time                               : 1.503559s</div>
<div class="line">Performance index                       : 0.43</div>
<div class="line">cpu_core.cpu0                           :  68.40 MIPS (    65196784 Inst)</div>
<div class="line">-------------------------------------------------------------------------------</div>
</div><!-- fragment --><p class="startli">Also see section <a href="https://developer.arm.com/documentation/100965/latest/Timing-Annotation/Timing-annotation-tutorial/Setting-up-the-environment/Displaying-the-total-execution-time-of-the-simulation">Displaying the total execution time</a> in the Fast Models User Guide.</p>
</li>
<li><a href="https://github.com/ARM-software/CMSIS-View">CMSIS-View</a> utility can be used to measure and analyze timing between events in the program, including statistical data. To store the log files on FVPs, <a class="el" href="hints.html#semihosting">semihosting</a> shall be enabled. CMSIS-View annotations can also be reused for event analysis and time measurement on real hardware.</li>
<li><a class="el" href="using.html#Config">Model Configuration</a> parameters can be used to control and impact the execution timing:<ul>
<li>With Cycle Per Instruction (CPI) settings <code>cpi_div</code> and <code>cpi_mul</code>.</li>
<li>With clock configurations such as Clock Rate Multiplier, for example <code>core_clk.mul</code> on Corstone-300.</li>
<li>With pipeline-impacting parameters such as for memory caches, Floating-Point-Unit (FPU) or M-Profile Vector Extensions (MVE), etc.</li>
</ul>
Chapter <a href="https://developer.arm.com/documentation/100965/latest/Timing-Annotation">Timing Annotations</a> in the Fast Models User Guide explains the performance estimation concept as implemented in the underlying FastModels technology. Note that the FVPs are built with Timing Annotations enabled (<code>FASTSIM_DISABLE_TA</code> set to 0).</li>
</ul>
<p>For interaction with external world such as via <a class="el" href="group__arm__vsi.html">Virtual Streaming Interface (VSI)</a> or <a class="el" href="hints.html#semihosting">Semihosting I/O</a> the timing differences need to be taken into account as explain in <a href="https://developer.arm.com/documentation/100966/1126/Getting-Started-with-Fixed-Virtual-Platforms/Timing-considerations-for-FVPs">Timing-considerations-for-FVPs</a>.</p>
<h1><a class="anchor" id="stop"></a>
Execution stop</h1>
<p>Embedded applications typically run with an infinite loop that ensures continuous program execution. But for executing regression tests as part of Continuous Integration (CI) workflows it is often required that program execution is stopped after a test is completed, so that the next test can be started.</p>
<p>FVP command line options <code>--cpulimit</code>, <code>--cyclelimit</code>, <code>--timelimit</code> and <code>--simlimit</code> can be used to stop execution after specified activity time, for example, for 20 wall-clock seconds, use <code>--timelimit 20</code>. See <a href="https://developer.arm.com/documentation/100966/latest/Getting-Started-with-Fixed-Virtual-Platforms/FVP-command-line-options">FVP command line options</a> for more details.</p>
<p>FVP models have <code>shutdown_on_eot</code> parameter that enables simple implementation of program exit. The parameter should be set in the <a class="el" href="using.html#Config">Model Configuration</a>, for example for FPV_Corstone_SSE-300:</p>
<div class="fragment"><div class="line">mps3_board.uart0.shutdown_on_eot=1   # (bool, init-time) default = &#39;0&#39; : Shutdown simulation when a EOT (ASCII 4) char is transmitted (useful for regression tests when semihosting is not available)</div>
</div><!-- fragment --><p>And then to trigger the shutdown, a EOT (ASCII 4) symbol can be transmitted to the corresponding serial interface from the program. The code below demonstrates an example, where the execution is stopped after target execution count is achieved. In this implementation the STDIO is assumed to be retargeted to the UART0:</p>
<div class="fragment"><div class="line"><span class="keywordflow">while</span> (1)  {</div>
<div class="line">  printf (<span class="stringliteral">&quot;Hello World %d\r\n&quot;</span>, count);</div>
<div class="line">  <span class="keywordflow">if</span> (count &gt; 100) printf (<span class="stringliteral">&quot;\x04&quot;</span>);  <span class="comment">// EOT (0x04) stops simulation</span></div>
<div class="line">  count++;</div>
<div class="line">  osDelay (1000);</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
	Copyright &copy; 2021-2023 Arm Limited (or its affiliates). All rights reserved.
	<!-- Use script below for auto-inserting date, project name, version, etc  -->
	<!-- <script type="text/javascript">
        writeFooter.call(this);
    </script> -->
    </li>
  </ul>
</div>
</body>
</html>
