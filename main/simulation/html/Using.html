<!-- HTML header for doxygen 1.9.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AVH FVP models: Using AVH FVPs</title>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="extra_navtree.css" rel="stylesheet" type="text/css"/>
<link href="extra_stylesheet.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="printComponentTabs.js"></script>
<script type="text/javascript" src="footer.js"></script>
<script type="text/javascript" src="toc.js"></script>
<script type="text/javascript">
  DoxygenAwesomeInteractiveToc.init()
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<script type="text/javascript" src="darkmode_toggle.js"></script>
<link href="extra_stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="extra_navtree.css" rel="stylesheet" type="text/css"/>
<link href="extra_search.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow" style="height: 55px;">
  <td id="projectlogo" style="padding: 1em;"><img alt="Logo" src="arm.png"/></td>
  <td style="padding-left: 2em; padding-bottom: 1em;padding-top: 1em;">
   <div id="projectname">Virtual Hardware
   &#160;<span id="projectnumber">Version 1.3.1 - beta</span>
   </div>
   <div id="projectbrief">AVH FVP Models</div>
  </td>
  <!--END !PROJECT_NAME-->
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<div id="Compnav" class="tabs1">
    <ul class="tablist">
      <script type="text/javascript">
		<!--
		writeComponentTabs.call(this);
		//-->
      </script>
	  </ul>
</div>
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('Using.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Using AVH FVPs </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_src_using"></a></p>
<p>This section gives an overview on how to use the <b>Arm Fixed Virtual Platforms (FVPs)</b> in AVH context.</p>
<p>The FVP simulation models in AVH correspond to a subset of <a href="https://developer.arm.com/tools-and-software/simulation-models/fixed-virtual-platforms">Arm Fast Models Fixed Virtual Platforms</a> with extensions for <a class="el" href="group__arm__cmvp.html">Virtual Interfaces</a>. They can be accessed in cloud-native and desktop environments as explained in <a href="../../infrastructure/html/index.html">Infrastructure chapter</a>. The table below lists the available models:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">FVP Simulation Model   </th><th class="markdownTableHeadLeft">Processor Core   </th><th class="markdownTableHeadLeft">Overview Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">VHT_MPS2_Cortex-M0   </td><td class="markdownTableBodyLeft">Cortex-M0   </td><td class="markdownTableBodyLeft"><a href="https://developer.arm.com/documentation/dai0382">ARM Cortex-M0 SMM on V2M-MPS2 (AppNote AN382)</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">VHT_MPS2_Cortex-M0plus   </td><td class="markdownTableBodyLeft">Cortex-M0+   </td><td class="markdownTableBodyLeft"><a href="https://developer.arm.com/documentation/dai0383">ARM Cortex-M0+ SMM on V2M-MPS2 (AppNote AN383)</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">VHT_MPS2_Cortex-M3   </td><td class="markdownTableBodyLeft">Cortex-M3   </td><td class="markdownTableBodyLeft"><a href="https://developer.arm.com/documentation/dai0385">ARM Cortex-M3 SMM on V2M-MPS2 (AppNote AN385)</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">VHT_MPS2_Cortex-M4   </td><td class="markdownTableBodyLeft">Cortex-M4   </td><td class="markdownTableBodyLeft"><a href="https://developer.arm.com/documentation/dai0386">ARM Cortex-M4 SMM on V2M-MPS2 (AppNote AN386)</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">VHT_MPS2_Cortex-M7   </td><td class="markdownTableBodyLeft">Cortex-M7   </td><td class="markdownTableBodyLeft"><a href="https://developer.arm.com/documentation/dai0386">ARM Cortex-M7 SMM on V2M-MPS2 (AppNote AN399)</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">VHT_MPS2_Cortex-M23   </td><td class="markdownTableBodyLeft">Cortex-M23   </td><td class="markdownTableBodyLeft"><a href="https://developer.arm.com/documentation/dai0519">ARM Cortex-M23 IoT Subsystem for V2M-MPS2+ (AppNote AN519)</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">VHT_MPS2_Cortex-M33   </td><td class="markdownTableBodyLeft">Cortex-M33   </td><td class="markdownTableBodyLeft"><a href="https://developer.arm.com/documentation/dai0505">ARM Cortex-M33 IoT Subsystem for V2M-MPS2+ (AppNote AN505)</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">VHT_MPS3_Corstone_SSE-300   </td><td class="markdownTableBodyLeft">Cortex-M55   </td><td class="markdownTableBodyLeft"><a href="./Corstone_SSE-300_Ethos-U55_FVP_MPS3_Technical_Overview.pdf">Corstone-300 FVP Technical Overview (PDF)</a>, <a href="https://developer.arm.com/documentation/100966/1118/Arm--Corstone-SSE-300-FVP/Memory-map-overview-for-Corstone-SSE-300">Memory map overview</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">VHT_Corstone_SSE-300_Ethos-U55   </td><td class="markdownTableBodyLeft">Cortex-M55, Ethos-U55   </td><td class="markdownTableBodyLeft"><a href="./Corstone_SSE-300_Ethos-U55_FVP_MPS3_Technical_Overview.pdf">Corstone-300 FVP Technical Overview (PDF)</a>, <a href="https://developer.arm.com/documentation/100966/1118/Arm--Corstone-SSE-300-FVP/Memory-map-overview-for-Corstone-SSE-300">Memory map overview</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">VHT_Corstone_SSE-300_Ethos-U65   </td><td class="markdownTableBodyLeft">Cortex-M55, Ethos-U65   </td><td class="markdownTableBodyLeft"><a href="./Corstone_SSE-300_Ethos-U55_FVP_MPS3_Technical_Overview.pdf">Corstone-300 FVP Technical Overview (PDF)</a>, <a href="https://developer.arm.com/documentation/100966/1118/Arm--Corstone-SSE-300-FVP/Memory-map-overview-for-Corstone-SSE-300">Memory map overview</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">VHT_Corstone_SSE-310   </td><td class="markdownTableBodyLeft">Cortex-M85, Ethos-U55   </td><td class="markdownTableBodyLeft"><a href="./Corstone_SSE-310_FVP_Technical_Overview.pdf">Corstone-310 FVP Technical Overview (PDF)</a>, <a href="https://developer.arm.com/documentation/100966/1118/Arm--Corstone-SSE-310-FVP/Corstone-SSE-310-FVP-memory-map-overview">Memory map overview</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">VHT_Corstone_SSE-310_Ethos-U65   </td><td class="markdownTableBodyLeft">Cortex-M85, Ethos-U65   </td><td class="markdownTableBodyLeft"><a href="./Corstone_SSE-310_FVP_Technical_Overview.pdf">Corstone-310 FVP Technical Overview (PDF)</a>, <a href="https://developer.arm.com/documentation/100966/1118/Arm--Corstone-SSE-310-FVP/Corstone-SSE-310-FVP-memory-map-overview">Memory map overview</a>   </td></tr>
</table>
<p>Additionally following FVP models are provided without support of Virtual Peripherals:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Simulation Model   </th><th class="markdownTableHeadLeft">Processor Core   </th><th class="markdownTableHeadLeft">Overview Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">FVP_Corstone-1000   </td><td class="markdownTableBodyLeft">Cortex-A35, Cortex-M0+, Cortex-M3   </td><td class="markdownTableBodyLeft"><a href="https://developer.arm.com/documentation/dai0550/">Arm Corstone-1000 for MPS3 (AppNote AN550)</a>   </td></tr>
</table>
<h1><a class="anchor" id="Execution"></a>
Running User Applications</h1>
<p>The FVP models can be executed from command prompt by using the model name followed by the model options. Development tools may abstract the execution with GUI, but the underlying approach stays the same.</p>
<p>Below is an example of the command for running a program on the FVP model for Corstone-300 with Ethos-U55 in Linux environment:</p>
<div class="fragment"><div class="line">VHT_Corstone_SSE-300_Ethos-U55 -a Objects\microspeech.axf -V &quot;..\VSI\audio\python&quot; -f fvp_config.txt  --stat --simlimit 24</div>
</div><!-- fragment --><p>Where:</p><ul>
<li><code>VHT_Corstone_SSE-300_Ethos-U55</code> is the simulation model name. Note that on Windows the executable files shall be used, for example <code>VHT_Corestone_SSE-300_Ethos-U55.exe</code>.</li>
<li><code>-a</code> (or <code>--application</code>) option specifies the application binary file to run on the model (<code>Objects\microspeech.axf</code> in this example).</li>
<li><code>-f</code> (or <code>--config-file</code>) specifies the configuration file for the simulation model (<code>fvp_config.txt</code> in this case). See <a class="el" href="Using.html#Config">Model Configuration</a>.</li>
<li><code>-V</code> (or <code>--v_path</code>) specifies the path to python scripts for <a class="el" href="group__arm__cmvp.html">Virtual Interfaces</a> (<code>"..\VSI\audio\python"</code> here).</li>
<li><code>--stat</code> instructs to print run statistics on simulation exit.</li>
<li><code>--simlimit</code> specifies the maximum number of seconds to simulate.</li>
</ul>
<p>The available command options can be listed using the <code>--help</code> option. See chapter <a href="https://developer.arm.com/documentation/100966/latest/Getting-Started-with-Fixed-Virtual-Platforms/FVP-command-line-options">FVP-command-line-options</a> in the FVP Reference Guide for additional documentations.</p>
<h1><a class="anchor" id="Config"></a>
Model Configuration</h1>
<p>The operation of the FVP models can be configured at start-time by providing following command-line options:</p><ul>
<li>using <code>-C</code> (or <code>--parameter</code>) option to configure individual parameters.</li>
<li>using option <code>-f</code> (or <code>--config-file</code>) followed by path to the text file with configuration parameters.</li>
</ul>
<p>The configuration parameters are model-specific and follow syntax <code>instance.parameter= &lt;value&gt;</code>, where <code>instance</code> specifies a simulated instance, such as CPU, interface, bus, memory, peripheral, etc. and can be also hierarchical.</p>
<p>All parameters available for a target model including default setting and brief description can be obtained with the command option <code>-l</code> (or <code>--list-params</code>). Because of the large number of parameters, it is convinient to print them into a text file. For example:</p>
<div class="fragment"><div class="line">VHT_Corstone_SSE-300_Ethos-U55 --list-params &gt; config.txt</div>
</div><!-- fragment --><p>In a simple case the content of the configuration file could be as shown below for VHT_Corstone_SSE-300 targets:</p>
<div class="fragment"><div class="line"># Parameters:</div>
<div class="line"># instance.parameter=value       #(type, mode) default = &#39;def value&#39; : description : [min..max]</div>
<div class="line">#------------------------------------------------------------------------------</div>
<div class="line">core_clk.mul=100000000                              # (int   , init-time) default = &#39;0x17d7840&#39; : Clock Rate Multiplier. This parameter is not exposed via CADI and can only be set in LISA</div>
<div class="line">mps3_board.telnetterminal0.start_telnet=0           # (bool  , init-time) default = &#39;1&#39;      : Start telnet if nothing connected</div>
<div class="line">mps3_board.uart0.out_file=-                         # (string, init-time) default = &#39;&#39;       : Output file to hold data written by the UART (use &#39;-&#39; to send all output to stdout)</div>
<div class="line">mps3_board.visualisation.disable-visualisation=1    # (bool  , init-time) default = &#39;0&#39;      : Enable/disable visualisation</div>
<div class="line">cpu0.semihosting-enable=1                           # (bool  , init-time) default = &#39;0&#39;      : Enable semihosting SVC traps. Applications that do not use semihosting must set this parameter to false.</div>
<div class="line">#------------------------------------------------------------------------------</div>
</div><!-- fragment --><p>Where:</p><ul>
<li><b>core_clk.mul=100000000</b> specifies the virtual time, in this case 100MHz CPU clock.</li>
<li><b>mps3_board.telnetterminal0.start_telnet=0</b> disables the Telnet connectivity.</li>
<li><b>mps3_board.uart0.out_file=-</b> UART output is send to stdout.</li>
<li><b>mps3_board.visualisation.disable-visualisation=1</b> disables the graphical user interface of the FVP.</li>
<li><b>cpu0.semihosting-enable=1</b> enables <a class="el" href="Using.html#semihosting">semihosting in the FVP</a>.</li>
</ul>
<p>Note that instances implemented in the model can be obtained with the command option <code>--list-instances</code> that returns instance names and corresponding Fast Model component type, version and brief description. Section <a href="https://developer.arm.com/documentation/100964/latest/Fast-Models-components">Fast Models components</a> explains all the components available with FastModel technology and can be used for finding more information about a specific instance in the FVP.</p>
<p>For additional details also see chapter <a href="https://developer.arm.com/documentation/100966/latest/Getting-Started-with-Fixed-Virtual-Platforms/Configuring-the-model">Configuring the model</a> in the Getting Started with Fixed Virtual Platforms Guide.</p>
<h1><a class="anchor" id="Hints"></a>
Useful Hints and Tips</h1>
<p>Below are some useful tips for using FVP models in common AVH scenarios.</p>
<h2><a class="anchor" id="stop"></a>
Execution stop</h2>
<p>Embedded applications typically run with an infinite loop that ensures continuous program execution. But for executing regression tests as part of Continuous Integration (CI) workflows it is often required that program execution is stopped after a test is completed, so that the next test can be started.</p>
<p>FVP models have <code>shutdown_on_eot</code> parameter that enables simple implementation of such program exit. The parameter should be set in the <a class="el" href="Using.html#Config">Model Configuration</a>, for example for VHT_Corstone_SSE-300:</p>
<div class="fragment"><div class="line">mps3_board.uart0.shutdown_on_eot=1   # (bool, init-time) default = &#39;0&#39; : Shutdown simulation when a EOT (ASCII 4) char is transmitted (useful for regression tests when semihosting is not available)</div>
</div><!-- fragment --><p>And then to trigger the shutdown, a EOT (ASCII 4) symbol can be transmitted to the corresponding serial interface from the program. The code below demonstrates an example, where the execution is stopped after target execution count is achieved. In this implementation the STDIO is assumed to be retargeted to the UART0:</p>
<div class="fragment"><div class="line"><span class="keywordflow">while</span> (1)  {</div>
<div class="line">  printf (<span class="stringliteral">&quot;Hello World %d\r\n&quot;</span>, count);</div>
<div class="line">  <span class="keywordflow">if</span> (count &gt; 100) printf (<span class="stringliteral">&quot;\x04&quot;</span>);  <span class="comment">// EOT (0x04) stops simulation</span></div>
<div class="line">  count++;</div>
<div class="line">  osDelay (1000);</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="timing"></a>
Execution timing</h2>
<p>FVP simulation models are targeted to software development and functional testing, and are not suitable for accurate performance comparisons on the CPU level. However, they can be well used to analyze timing on the program level, such as for scheduling RTOS tasks, detecting deadlocks, but also identifying overall performance trends.</p>
<p>Following mechanisms and settings can be used for timing control and measurements:</p><ul>
<li>FVP model can be started with command-line option <code>--stat</code> to print the execution statistics on simulation exit. Here is an example of such statistics output: <div class="fragment"><div class="line">--- cpu_core statistics: ------------------------------------------------------</div>
<div class="line">Simulated time                          : 0.651964s</div>
<div class="line">User time                               : 0.843750s</div>
<div class="line">System time                             : 0.109375s</div>
<div class="line">Wall time                               : 1.503559s</div>
<div class="line">Performance index                       : 0.43</div>
<div class="line">cpu_core.cpu0                           :  68.40 MIPS (    65196784 Inst)</div>
<div class="line">-------------------------------------------------------------------------------</div>
</div><!-- fragment --> Also see <a href="https://developer.arm.com/documentation/100965/latest/Timing-Annotation/Timing-annotation-tutorial/Setting-up-the-environment/Displaying-the-total-execution-time-of-the-simulation">corresponding section</a> in the Fast Models User Guide.</li>
<li><a href="https://github.com/ARM-software/CMSIS-View">CMSIS-View</a> utility can be used to measure and analyze timing between events in the program, including statistical data. To store the log files on FVPs, <a class="el" href="Using.html#semihosting">semihosting</a> shall be enabled. CMSIS-View annotations can also be reused for event analysis and time measurement on real hardware.</li>
<li><a class="el" href="Using.html#Config">Model Configuration</a> parameters can be used to control and impact the execution timing:<ul>
<li>With Cycle Per Instruction (CPI) settings <code>cpi_div</code> and <code>cpi_mul</code>.</li>
<li>With clock configurations such as Clock Rate Multiplier, for example <code>core_clk.mul</code> on Corstone-300.</li>
<li>With pipeline-impacting parameters such as for memory caches, Floating-Point-Unit (FPU) or M-Profile Vector Extensions (MVE), etc.</li>
</ul>
Chapter <a href="https://developer.arm.com/documentation/100965/latest/Timing-Annotation">Timing Annotations</a> in the Fast Models User Guide explains the performance estimation concept as implemented in the underlying FastModels technology. Note that the FVPs are built with Timing Annotations enabled (<code>FASTSIM_DISABLE_TA</code> set to 0).</li>
</ul>
<h2><a class="anchor" id="semihosting"></a>
Semihosting</h2>
<p>Semihosting is a mechanism that enables code running on an FVP model to directly access the Input/Output facilities on a host computer, such as console I/O and file I/O.</p>
<p>This is often useful for testing and debugging your software when use of HW I/O interfaces in the model is not strictly required or would unnecessary complicate the program.</p>
<p>By default semihosting is disabled in FVPs and can be enabled with <code>semihosting-enable</code> configuration parameter on the CPU instance . For example for VHT_Corstone_SSE-300/310: </p><div class="fragment"><div class="line">cpu0.semihosting-enable=1</div>
</div><!-- fragment --><p> and for VHT_MPS2_Cortex-M4: </p><div class="fragment"><div class="line">armcortexm4ct.semihosting-enable=1</div>
</div><!-- fragment --><p>Semihosting can be useful in various scenarios with some of them listed below:</p><ul>
<li><a href="https://github.com/ARM-software/CMSIS-View">CMSIS-View</a> utility can be used with FVPs in semihosting mode to store the events into the log file on the host. See more in <a href="https://arm-software.github.io/CMSIS-View/main/er_use.html#er_semihosting">Event Recorder semihosting</a>.</li>
<li>Direct use of the host platform when invoking <code>stdio.h</code> functions. This for example allows to bypass message redirection via UART. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
	Copyright &copy; 2021-2023 Arm Limited (or its affiliates). All rights reserved.
	<!-- Use script below for auto-inserting date, project name, version, etc  -->
	<!-- <script type="text/javascript">
        writeFooter.call(this);
    </script> -->
    </li>
  </ul>
</div>
</body>
</html>
